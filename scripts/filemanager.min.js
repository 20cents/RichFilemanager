/*
	MIT License
 @author		Jason Huck - Core Five Labs
 @author		Simon Georget <simon (at) linea21 (dot) com>
 @author		Pavel Solomienko <https://github.com/servocoder/>
 @copyright	Authors
*/
var $jscomp={scope:{},findInternal:function(d,r,p){d instanceof String&&(d=String(d));for(var n=d.length,v=0;v<n;v++){var E=d[v];if(r.call(p,E,v,d))return{i:v,v:E}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(d,r,p){if(p.get||p.set)throw new TypeError("ES3 does not support getters and setters.");d!=Array.prototype&&d!=Object.prototype&&(d[r]=p.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,r,p,n){if(r){p=$jscomp.global;d=d.split(".");for(n=0;n<d.length-1;n++){var v=d[n];v in p||(p[v]={});p=p[v]}d=d[d.length-1];n=p[d];r=r(n);r!=n&&null!=r&&$jscomp.defineProperty(p,d,{configurable:!0,writable:!0,value:r})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,p){return $jscomp.findInternal(this,d,p).v}},"es6-impl","es3");
(function(d){d.urlParam=function(d){return(d=(new RegExp("[\\?&]"+d+"=([^&#]*)")).exec(window.location.href))?d[1]:0};d.richFilemanagerPlugin=function(r,p){function n(a,c){return-1===z.indexOf(c)||"folder"===a.type&&"replace"===c||"folder"===a.type&&"select"===c?!1:"folder"===a.type&&"download"===c?!0===e.security.allowFolderDownload:"undefined"!==typeof a.attributes.capabilities?-1<d.inArray(c,a.attributes.capabilities):!0}function v(){return window.opener||window.tinyMCEPopup||window.self!==window.top||
d.urlParam("field_name")||d.urlParam("CKEditor")||d.urlParam("ImperaviElementId")}function E(a){var c=!g.clipboardModel.enabled(),b={select:{name:h.select,className:"select"},download:{name:h.download,className:"download"},rename:{name:h.rename,className:"rename"},move:{name:h.move,className:"move"},replace:{name:h.replace,className:"replace"},separator1:"-----",copy:{name:h.clipboard_copy,className:"copy"},cut:{name:h.clipboard_cut,className:"cut"},"delete":{name:h.del,className:"delete"}};n(a,"download")||
delete b.download;n(a,"select")&&v()||delete b.select;n(a,"rename")&&!0!==e.options.browseOnly||delete b.rename;n(a,"delete")&&!0!==e.options.browseOnly||delete b["delete"];n(a,"copy")&&!0!==e.options.browseOnly&&!c||delete b.copy;if(!n(a,"move")||!0===e.options.browseOnly||c)delete b.cut,delete b.move;delete b.replace;return b}var l=this,F=d(r),H=F.children(".fm-wrapper"),T=H.find(".fm-header"),U=T.find(".fm-uploader"),B=H.children(".fm-splitter"),fa=H.children(".fm-footer"),C=B.children(".fm-fileinfo"),
I=B.children(".fm-filetree"),L=C.find(".view-items"),w=U.children(".fm-upload"),e=null,h=null,y="/",M=null,z=[],N=null,O=null,g=null,D=null,ga=(new Date).getTime();l.settings=d.extend(!0,{baseUrl:".",config:{},callbacks:{beforeCreateImageUrl:function(a,c){return c},beforeCreatePreviewUrl:function(a,c){return c},beforeSelectItem:function(a,c){return c},afterSelectItem:function(a,c){}}},p);l.log=function(a,c){var b=alertify,k=d.extend({},{reset:!0,delay:5E3,logMaxItems:5,logPosition:"bottom right",
logContainerClass:"fm-log",parent:d(".fm-popup").is(":visible")?document.body:C[0],onClick:void 0,unique:!1,type:"log"},c);if(k.logClass&&k.unique&&0<d(".fm-log").children("."+k.logClass).length)return b;k.reset&&b.reset();k.parent&&b.parent(k.parent);b.logDelay(k.delay);b.logMaxItems(k.logMaxItems);b.logPosition(k.logPosition);b.logContainerClass(k.logContainerClass);b[k.type](a,k.onClick);return b};l.error=function(a,c){return l.log(a,d.extend({},{type:"error",delay:1E4},c))};l.warning=function(a,
c){return l.log(a,d.extend({},{type:"warning",delay:1E4},c))};l.success=function(a,c){return l.log(a,d.extend({},{type:"success",delay:6E3},c))};l.alert=function(a){alertify.reset().dialogContainerClass("fm-popup").alert(a)};l.confirm=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").confirm(a.message,a.okBtn,a.cancelBtn)};l.prompt=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").theme(a.template).prompt(a.message,
a.value||"",a.okBtn,a.cancelBtn)};l.dialog=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").dialog(a.message,a.buttons)};l.setDimensions=function(){var a=0,c=F.outerHeight(!0)-F.height();d.urlParam("CKEditorCleanUpFuncNum")&&(a+=60);a=d(window).height()-T.height()-fa.height()-c-a;B.height(a);c=d(document).height()-d(window).height();!F.parent().is("body")&&0<c&&(a-=c,B.height(0<a?a:1));a=B.width()-B.children(".splitter-bar-vertical").outerWidth()-
I.outerWidth();C.width(a)};var ha=function(){return d.when(V("default"),V("user")).done(function(a,c){var b=a[0],k=c[0];void 0!==k&&null!==k&&delete k.version;e=d.extend({},b,k);e.api.connectorUrl?M=e.api.connectorUrl:(b=location.origin+location.pathname,k="connectors/"+e.api.lang+"/filemanager."+e.api.lang,0<x(b).length&&(b=b.substring(0,b.lastIndexOf("/")+1)),M=b+k)})},ia=function(){return d.ajax({type:"GET",url:q({mode:"initiate"}),dataType:"json"}).done(function(a){a.data&&d.each(a.data.attributes.config,
function(a,b){d.each(b,function(c,b){"undefined"!==e[a]&&"undefined"!==e[a][c]&&(e[a][c]=b)})});t(a)}).fail(function(){l.error("Unable to perform initial request to server.")}).then(function(a){if(a.errors)return d.Deferred().reject()})},ja=function(){var a=d.urlParam("langCode"),c=l.settings.baseUrl+"/languages/";return d.ajax().then(function(){if(0!=a)return d.ajax({type:"HEAD",url:c+a+".json"}).done(function(){e.options.culture=a}).fail(function(){setTimeout(function(){l.error("Given language file ("+
(c+a+".json")+") does not exist!")},500)})}).then(function(){return d.ajax({type:"GET",url:c+e.options.culture+".json",dataType:"json"}).done(function(a){h=a})})},ka=function(){return d.when(W("upload-container"),W("upload-item")).done(function(a,c){var b=c[0];H.append(a[0]).append(b)})},la=function(a){var c=[],b=[];c.push("/themes/"+e.options.theme+"/styles/theme.css");e.customScrollbar.enabled&&(c.push("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css"),c.push("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"));
c.push(a);P(c);e.viewer.editable.enabled&&((a=e.viewer.editable.theme)&&"default"!==a&&b.push("/scripts/CodeMirror/theme/"+a+".css"),b.push("/scripts/CodeMirror/lib/codemirror.css"),b.push("/scripts/CodeMirror/lib/codemirror.js"),b.push("/scripts/CodeMirror/addon/selection/active-line.js"),b.push("/scripts/CodeMirror/addon/display/fullscreen.css"),b.push("/scripts/CodeMirror/addon/display/fullscreen.js"));e.options.browseOnly||(b.push("/scripts/jQuery-File-Upload/js/vendor/jquery.ui.widget.js"),b.push("/scripts/jQuery-File-Upload/js/canvas-to-blob.min.js"),
b.push("/scripts/jQuery-File-Upload/js/load-image.all.min.js"),b.push("/scripts/jQuery-File-Upload/js/jquery.iframe-transport.js"),b.push("/scripts/jQuery-File-Upload/js/jquery.fileupload.js"),b.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-process.js"),b.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-image.js"),b.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-validate.js"),e.upload.multiple&&b.push("/scripts/jQuery-File-Upload/css/dropzone.css"));e.options.charsLatinOnly&&
b.push("/scripts/speakingurl/speakingurl.min.js");b.length&&P(b)},oa=function(){z=e.options.capabilities||"upload select download rename copy move delete replace".split(" ");var a=[];e.options.fileSorting&&(a=e.options.fileSorting.toLowerCase().split("_"));N=a[0]||"name";O=a[1]||"asc";0!=d.urlParam("exclusiveFolder")&&(y+=d.urlParam("exclusiveFolder"),Q(y)&&(y+="/"),y=y.replace(/\/\//g,"/"));a="";0!=d.urlParam("expandedFolder")&&(a=d.urlParam("expandedFolder"),D=y+a,D=D.replace(/\/\//g,"/"));g=new ma;
ko.applyBindings(g);ko.bindingHandlers.toggleNodeVisibility={init:function(a,b){var c=b();d(a).toggle(c.isExpanded())},update:function(a,b){var c=b();if(!1===c.isSliding())return!1;!1===c.isExpanded()&&d(a).slideDown(g.treeModel.options.expandSpeed,function(){c.isSliding(!1);c.isExpanded(!0)});!0===c.isExpanded()&&d(a).slideUp(g.treeModel.options.expandSpeed,function(){c.isSliding(!1);c.isExpanded(!1)})}};ko.bindingHandlers.draggableView={init:function(a,b,k){var c=b();"file"!==c.rdo.type&&"folder"!==
c.rdo.type||d(a).draggable({distance:3,cursor:"pointer",refreshPositions:!1,helper:function(){var a;a=g.itemsModel.getSelected();var c="drag-helper-"+g.viewMode(),c=d("<div>",{"class":c});a=1<a.length?d("#drag-helper-"+g.viewMode()+"-template").clone():d(this).clone();return c.append(a.html())},appendTo:e.customScrollbar.enabled?C.find(".mCustomScrollBox"):C,start:function(a,b){c.selected()||(g.itemsModel.unselectItems(!1),c.selected(!0))},drag:function(a,c){d(this).draggable("option","refreshPositions",
g.itemsModel.isScrolling())}})}};ko.bindingHandlers.droppableView={init:function(a,b,k){function c(a,c){var b=d.grep(c,function(c,b){return c.id===a.id});return!(a.rdo.attributes.write_protected||0<b.length)}"folder"!==b().rdo.type&&"parent"!==b().rdo.type||d(a).droppable({enableExtendedEvents:!0,accept:function(a){a=(a=ko.dataFor(a[0]))?a.rdo.type:null;return"file"===a||"folder"===a},over:function(a,b){var f=ko.dataFor(a.target),m=g.itemsModel.getSelected();c(f,m)?d(this).addClass("drop-hover"):
b.helper.addClass("drop-restricted")},out:function(a,c){d(this).removeClass("drop-hover");c.helper.removeClass("drop-restricted")},drop:function(a,b){var f=ko.dataFor(a.target),m=g.itemsModel.getSelected();d(a.target).removeClass("drop-hover");if(!c(f,m))return!1;J(m,function(a,c){return K(c.rdo,f.id)})}})}};L.selectable({filter:"li:not(.directory-parent), tr:not(.directory-parent)",cancel:".directory-parent",disabled:!e.manager.selection.enabled,appendTo:".fm-container",start:function(a,b){document.selection&&
document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()},selected:function(a,b){ko.dataFor(b.selected).selected(!0)},unselected:function(a,b){ko.dataFor(b.unselected).selected(!1)}});ko.bindingHandlers.draggableTree={init:function(a,b,k){b=b();"file"!==b.rdo.type&&"folder"!==b.rdo.type||d(a).draggable({distance:3,cursor:"pointer",refreshPositions:!1,helper:function(){return d("<li>").append(d(this).clone())},appendTo:e.customScrollbar.enabled?
I.find(".mCustomScrollBox"):I,drag:function(a,c){d(this).draggable("option","refreshPositions",g.treeModel.isScrolling())}})}};ko.bindingHandlers.droppableTree={init:function(a,b,k){"folder"!==b().rdo.type&&"parent"!==b().rdo.type||d(a).droppable({hoverClass:"drop-hover",accept:function(a){if(a.closest("ul").prev("a").is(d(this))||d.contains(a.parent()[0],this))return!1;a=(a=ko.dataFor(a[0]))?a.rdo.type:null;return"file"===a||"folder"===a},drop:function(a,c){K(ko.dataFor(c.draggable[0]),ko.dataFor(a.target).id)}})}};
C.contextMenu({selector:".view-items",zIndex:10,build:function(a,b){var c={createFolder:{name:h.create_folder,className:"create-folder"},paste:{name:h.clipboard_paste,className:"paste",disabled:function(a,c){return g.clipboardModel.isEmpty()}}};g.clipboardModel.enabled()&&!0!==e.options.browseOnly||delete c.paste;return{appendTo:".fm-container",items:c,reposition:!1,callback:function(a,c){switch(a){case "createFolder":g.headerModel.createFolder();break;case "paste":g.clipboardModel.paste()}}}}});
if(e.extras.extra_js)for(a=0;a<e.extras.extra_js.length;a++)d.ajax({type:"GET",url:e.extras.extra_js[a],dataType:"script",async:e.extras.extra_js_async});d.urlParam("CKEditorCleanUpFuncNum")&&(d("body").append('<button id="fm-js-btn-close" type="button">'+h.close+"</button>"),d("#fm-js-btn-close").click(function(){parent.CKEDITOR.tools.callFunction(d.urlParam("CKEditorCleanUpFuncNum"))}));d("#newfile").change(function(){d("#filepath").val(d(this).val().replace(/.+[\\\/]/,""))});e.customScrollbar.enabled&&
(I.mCustomScrollbar({theme:e.customScrollbar.theme,scrollButtons:{enable:e.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onScrollStart:function(){g.treeModel.isScrolling(!0)},onScroll:function(){g.treeModel.isScrolling(!1)}},axis:"yx"}),L.mCustomScrollbar({theme:e.customScrollbar.theme,scrollButtons:{enable:e.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onScrollStart:function(){g.itemsModel.isScrolling(!0)},
onScroll:function(){g.itemsModel.isScrolling(!1)}},axis:"y",alwaysShowScrollbar:0}));document.documentElement.setAttribute("data-useragent",navigator.userAgent);e.options.logger&&(a=(new Date).getTime()-ga,console.log("Total execution time : "+a+" ms"));B.splitter({sizeLeft:e.options.splitterWidth,minLeft:e.options.splitterMinWidth,minRight:200});F.find(".fm-loading-wrap").fadeOut(800);d(window).trigger("resize");g.treeModel.loadNodes(null,!1);na()},ma=function(){var a=this;this.config=ko.observable(e);
this.lg=ko.observable(h);this.loadingView=ko.observable(!0);this.previewFile=ko.observable(!1);this.viewMode=ko.observable(e.options.defaultViewMode);this.currentPath=ko.observable(y);this.browseOnly=ko.observable(e.options.browseOnly);this.previewFile.subscribe(function(c){c||a.previewModel.closeEditor()});this.addItem=function(a,b){var c=g.treeModel.findByParam("id",b);if(c){var f=g.treeModel.createNode(a);g.treeModel.addNodes(c,f)}g.currentPath()===b&&g.itemsModel.addNew(a)};this.removeItem=function(a){var c=
g.treeModel.findByParam("id",a.id);c&&c.remove();(a=g.itemsModel.findByParam("id",a.id))&&a.remove()};this.treeModel=new function(){var c=this;this.isScrolling=ko.observable(!1);this.selecledNode=ko.observable(null);this.options={showLine:!0,dblClickOpen:e.manager.dblClickOpen,reloadOnClick:!1,expandSpeed:200};this.treeData={id:y,level:ko.observable(-1),children:ko.observableArray([])};this.treeData.children.subscribe(function(a){c.arrangeNode(c.treeData)});var b=function(a){null!==D&&(a||(a=c.treeData),
(a=c.findByFilter(function(a){return 0===D.indexOf(a.id)},a))?(c.options.expandSpeed=10,c.loadNodes(a,!1)):(D=null,c.options.expandSpeed=200))};this.findByParam=function(a,b,d){if(!d&&(d=c.treeData,d[a]===b))return d;d=d.children();if(!d||0===d.length)return null;for(var f=0,m=d.length;f<m;f++){if(d[f][a]===b)return d[f];var e=c.findByParam(a,b,d[f]);if(e)return e}return null};this.findByFilter=function(a,b){if(!b&&(b=c.treeData,a(b)))return b;var d=b.children();if(!d||0===d.length)return null;for(var f=
0,e=d.length;f<e;f++){if(a(d[f]))return d[f];var m=c.findByFilter(a,d[f]);if(m)return m}return null};this.loadNodes=function(a,e){var f=a?a.id:c.treeData.id;a&&a.isLoaded(!1);var m={mode:"getfolder",path:f};d.urlParam("type")&&(m.type=d.urlParam("type"));d.ajax({type:"GET",url:q(m),dataType:"json",cache:!1,success:function(m){if(m.data){g.currentPath(f);g.itemsModel.setList(m.data);var k=[];d.each(m.data,function(a,b){var d=c.createNode(b);k.push(d)});e&&a.children([]);c.addNodes(a,k);a&&(a.isLoaded(!0),
c.expandNode(a));b(a)}t(m)},error:u})};this.createNode=function(a){return new k(a)};this.addNodes=function(a,b){d.isArray(b)||(b=[b]);a||(a=c.treeData);e.options.listFiles||(b=d.grep(b,function(a){return a.cdo.isFolder}));d.each(b,function(c,b){b.parentNode(a)});var f=a.children().concat(b);a.children(X(f))};this.expandNode=function(a){return!1===a.isExpanded()&&!0===a.isLoaded()?(a.isSliding(!0),!0):!1};this.collapseNode=function(a){return!0===a.isExpanded()?(a.isSliding(!0),!0):!1};this.arrangeNode=
function(a){var c=a.children().length;d.each(a.children(),function(b,d){d.level(a.level()+1);d.isFirstNode(0===b);d.isLastNode(b===c-1)})};this.nodeRendered=function(a,c){d(a[1]).contextMenu({selector:".file, .directory",zIndex:100,build:function(a,b){return{appendTo:".fm-container",items:E(c.rdo),callback:function(a,b){R(a,c.rdo)}}}})};this.actualizeNodeObject=function(a,b,e){var f=a.rdo.id,k=f.replace(new RegExp("^"+b),e);a.id=k;a.rdo.id=k;a.rdo.attributes.path=a.rdo.attributes.path.replace(new RegExp(f+
"$"),k);a.children().length&&d.each(a.children(),function(a,d){c.actualizeNodeObject(d,b,e)})};var k=function(b){var f=this;this.id=b.id;this.rdo=b;this.cdo={isFolder:"folder"===b.type,dimensions:b.attributes.width?b.attributes.width+"x"+b.attributes.height:null,cssItemClass:"folder"===b.type?"directory":"file"};this.nodeTitle=ko.observable(b.attributes.name);this.children=ko.observableArray([]);this.parentNode=ko.observable(null);this.isSliding=ko.observable(!1);this.isLoading=ko.observable(!1);
this.isLoaded=ko.observable(!1);this.isExpanded=ko.observable(!1);this.isSelected=ko.observable(!1);this.level=ko.observable(0);this.isFirstNode=ko.observable(!1);this.isLastNode=ko.observable(!1);this.nodeTitle.subscribe(function(a){f.rdo.attributes.name=a});this.children.subscribe(function(a){c.arrangeNode(f)});this.isLoaded.subscribe(function(a){f.isLoading(!a)});this.switchNode=function(a){if(!a.cdo.isFolder)return!1;if(a.rdo.attributes.read_protected)return l.error(h.NOT_ALLOWED_SYSTEM),!1;f.toggleNode(a,
!1)};this.nodeClick=function(a){c.options.dblClickOpen||(f.openNode(a),f.toggleNode(a,c.options.reloadOnClick));null!==c.selecledNode()&&c.selecledNode().isSelected(!1);a.isSelected(!0);c.selecledNode(a)};this.nodeDblClick=function(a){c.options.dblClickOpen&&(f.openNode(a),f.toggleNode(a,c.options.reloadOnClick))};this.toggleNode=function(a,b){"folder"===a.rdo.type&&(a.isExpanded()||!b&&a.isLoaded()?a.isSliding(!0):c.loadNodes(a,!0))};this.openNode=function(b){"file"===b.rdo.type&&Y(b.rdo);if("folder"===
b.rdo.type&&b.isLoaded()){var c=[];b.children().length&&d.each(b.children(),function(a,b){c.push(b.rdo)});a.currentPath(b.rdo.id);a.itemsModel.setList(c)}};this.remove=function(){f.parentNode().children.remove(f)};this.isRoot=function(){return f.level()===c.treeData.id};this.title=ko.pureComputed(function(){return e.options.showTitleAttr?this.rdo.id:null},this);this.iconClass=ko.pureComputed(function(){var a,b=["ico"];!0===this.cdo.isFolder?(a="ico_folder",!0===this.isLoading()?b.push("loading"):
(b.push("folder"),this.rdo.attributes.read_protected?b.push("lock"):(this.isExpanded()||!this.isExpanded()&&this.isSliding())&&b.push("open"))):(a="ico_file",this.rdo.attributes.read_protected?b.push("file","lock"):b.push("ext",this.rdo.attributes.extension));return a+" "+b.join("_")},this);this.switcherClass=ko.pureComputed(function(){var a=[];c.options.showLine?0===this.level()&&this.isFirstNode()&&this.isLastNode()?a.push("root"):0==this.level()&&this.isFirstNode()?a.push("roots"):this.isLastNode()?
a.push("bottom"):a.push("center"):a.push("noline");if(this.cdo.isFolder){var b=this.isExpanded()||!this.isExpanded()&&this.isSliding();a.push(b?"open":"close")}else a.push("docu");return a.join("_")},this);this.clusterClass=ko.pureComputed(function(){return c.options.showLine&&!this.isLastNode()?"line":""},this)}};this.itemsModel=new function(){function c(a){return e.manager.selection.enabled&&e.manager.selection.useCtrlKey&&!0===a.ctrlKey||e.manager.dblClickOpen&&"click"===a.type?!1:!0}var b=this;
this.objects=ko.observableArray([]);this.objectsSize=ko.observable(0);this.objectsNumber=ko.observable(0);this.selectedNumber=ko.observable(0);this.listSortField=ko.observable(N);this.listSortOrder=ko.observable(O);this.isScrolling=ko.observable(!1);this.createObject=function(a){return new k(a)};this.addNew=function(c){d.isArray(c)||(c=[c]);d.each(c,function(c,d){a.itemsModel.objects.push(b.createObject(d))});a.itemsModel.sortObjects()};this.loadList=function(b){a.loadingView(!0);var c={mode:"getfolder",
path:b};d.urlParam("type")&&(c.type=d.urlParam("type"));d.ajax({type:"GET",url:q(c),dataType:"json",cache:!1,success:function(c){c.data&&(a.currentPath(b),a.itemsModel.setList(c.data));t(c)},error:u})};this.setList=function(f){var e=[];if(!Q(a.currentPath())&&a.currentPath()!==y){var k=Z(a.currentPath()),g={id:k,rdo:{id:k,type:"parent",attributes:{"protected":!1}},open:function(a,d){c(d)&&b.loadList(g.id)}};e.push(g)}d.each(f,function(a,c){e.push(b.createObject(c))});a.itemsModel.objects(e);a.itemsModel.sortObjects();
a.loadingView(!1)};this.findByParam=function(b,c){return ko.utils.arrayFirst(a.itemsModel.objects(),function(a){return a[b]===c})};this.findByFilter=function(a,c){var d=!c,f=[],e=b.objects();if(!e||0===e.length)return null;for(var k=0,g=e.length;k<g;k++)if(a(e[k])){if(d)return e[k];f.push(e[k])}return d?null:f};this.sortObjects=function(){var a=X(b.objects());b.objects(a)};this.getSelected=function(){var a=b.findByFilter(function(a){return"parent"!==a.rdo.type&&a.selected()},!0);b.selectedNumber(a.length);
return a};this.unselectItems=function(a){e.manager.selection.enabled&&e.manager.selection.useCtrlKey&&!0===a||d.each(b.getSelected(),function(a,b){b.selected(!1)})};this.objects.subscribe(function(a){var c=0,f=0;d.each(a,function(a,b){"parent"!==b.rdo.type&&c++;"file"===b.rdo.type&&(f+=Number(b.rdo.attributes.size))});b.objectsNumber(c);b.objectsSize(A(f));L.contextMenu({selector:".file, .directory",zIndex:100,build:function(a,b){var c=ko.dataFor(a[0]);c.selected()||(g.itemsModel.unselectItems(!1),
c.selected(!0));return{appendTo:".fm-container",items:E(c.rdo),callback:function(a,b){var f=[];d.each(g.itemsModel.getSelected(),function(a,b){f.push(b.rdo)});R(a,c.rdo,f)}}}})});var k=function(a){var d=e.viewer.image.thumbMaxWidth;a.attributes.width&&a.attributes.width<d&&(d=a.attributes.width);this.id=a.id;this.rdo=a;this.cdo={isFolder:"folder"===a.type,sizeFormatted:A(a.attributes.size),dimensions:a.attributes.width?a.attributes.width+"x"+a.attributes.height:null,cssItemClass:"folder"===a.type?
"directory":"file",imageUrl:aa(a,!0),previewWidth:d};this.visible=ko.observable(!0);this.selected=ko.observable(!1);this.title=ko.pureComputed(function(){return e.options.showTitleAttr?this.rdo.id:null},this);this.itemClass=ko.pureComputed(function(){var a=[];this.selected()&&e.manager.selection.enabled&&a.push("ui-selected");return this.cdo.cssItemClass+" "+a.join(" ")},this);this.listIconClass=ko.pureComputed(function(){var a,b=["ico"];!0===this.cdo.isFolder?(a="ico_folder",b.push("folder"),this.rdo.attributes.read_protected&&
b.push("lock")):(a="ico_file",this.rdo.attributes.read_protected?b.push("file","lock"):b.push("ext",this.rdo.attributes.extension));return a+" "+b.join("_")},this);this.gridIconClass=ko.pureComputed(function(){var a=[],b=["ico"];this.cdo.imageUrl||(a.push("grid-icon"),!0===this.cdo.isFolder?(a.push("ico_folder"),b.push("folder"),this.rdo.attributes.read_protected&&b.push("lock")):(a.push("ico_file"),this.rdo.attributes.read_protected?b.push("file","lock"):b.push("ext",this.rdo.attributes.extension)),
a.push(b.join("_")));return a.join(" ")},this);this.open=function(a,d){b.unselectItems(d.ctrlKey);this.selected(!this.selected());c(d)&&(e.options.quickSelect&&"file"===this.rdo.type&&n(this.rdo,"select")?ba(this.rdo):Y(this.rdo))};this.remove=function(){b.objects.remove(this)}}};this.tableViewModel=new function(){var c=function(b){var c=this;this.column=ko.observable(b);this.order=ko.observable(a.itemsModel.listSortOrder());this.sortClass=ko.pureComputed(function(){var b;a.itemsModel.listSortField()===
c.column()&&(b="sorted sorted-"+this.order());return b},this);this.sort=function(){var b="asc"===c.order(),d=a.itemsModel.listSortField()===c.column();c.order(d?b?"desc":"asc":a.itemsModel.listSortOrder());a.itemsModel.listSortField(c.column());a.itemsModel.listSortOrder(c.order());a.itemsModel.sortObjects()}};this.thName=new c("name");this.thType=new c("type");this.thSize=new c("size");this.thDimensions=new c("dimensions");this.thModified=new c("modified")};this.previewModel=new function(){var c=
this;this.rdo={};this.cdo={};this.viewer=ko.observable({});this.editor={enabled:ko.observable(!1),content:ko.observable(""),codeMirror:ko.observable(null)};this.bindToolbar=function(a){n(c.rdo,a)&&R(a,c.rdo)};this.load=function(b){a.previewFile(!1);c.rdo=b;c.cdo={isFolder:"folder"===b.type,sizeFormatted:A(b.attributes.size),dimensions:b.attributes.width?b.attributes.width+"x"+b.attributes.height:null};var k=b.attributes.name,f={type:"image",url:aa(b,!1),options:{}};-1!==d.inArray(x(k),e.viewer.editable.extensions)&&
!0===e.viewer.editable.enabled&&(f.type="editable");-1!==d.inArray(x(k),e.viewer.audio.extensions)&&!0===e.viewer.audio.enabled&&(f.type="audio",f.url=G(b,!0));-1!==d.inArray(x(k),e.viewer.video.extensions)&&!0===e.viewer.video.enabled&&(f.type="video",f.url=G(b,!0),f.options={width:e.viewer.video.playerWidth,height:e.viewer.video.playerHeight});-1!==d.inArray(x(k),e.viewer.opendoc.extensions)&&!0===e.viewer.opendoc.enabled&&(f.type="opendoc",f.url=l.settings.baseUrl+"/scripts/ViewerJS/index.html#"+
G(b,!0),f.options={width:e.viewer.opendoc.readerWidth,height:e.viewer.opendoc.readerHeight});-1!==d.inArray(x(k),e.viewer.google.extensions)&&!0===e.viewer.google.enabled&&(f.type="google",f.url="http://docs.google.com/viewer?url="+encodeURIComponent(G(b,!1))+"&embedded=true",f.options={width:e.viewer.google.readerWidth,height:e.viewer.google.readerHeight});this.previewIconClass=ko.pureComputed(function(){var a=[],b=["ico"];"image"!==f.type&&"editable"!==f.type||f.url||(a.push("grid-icon"),!0===this.cdo.isFolder?
(a.push("ico_folder"),b.push("folder"),this.rdo.attributes.read_protected&&b.push("lock")):(a.push("ico_file"),this.rdo.attributes.read_protected?b.push("file","lock"):b.push("ext",this.rdo.attributes.extension)),a.push(b.join("_")));return a.join(" ")},this);c.viewer(f);a.previewFile(!0);ZeroClipboard.config({swfPath:l.settings.baseUrl+"/scripts/zeroclipboard/dist/ZeroClipboard.swf"});var g=new ZeroClipboard(document.getElementById("fm-js-clipboard-copy"));g.on("ready",function(a){g.on("aftercopy",
function(a){l.success(h.copied)})})};this.editFile=function(){pa(c.rdo)};this.saveFile=function(){qa(c.rdo)};this.closeEditor=function(){c.editor.enabled(!1)};this.buttonVisibility=function(a){switch(a){case "select":return n(c.rdo,a)&&v();case "move":case "rename":case "delete":case "replace":return n(c.rdo,a)&&!0!==e.options.browseOnly;case "download":return n(c.rdo,a)}}};this.headerModel=new function(){this.goHome=function(){a.previewFile(!1);a.itemsModel.loadList(y)};this.goParent=function(){var c;
a.previewFile()?(c=a.previewModel.rdo.id,c=c.lastIndexOf("/")!==c.length-1?c.substr(0,c.lastIndexOf("/")+1):c):c=Z(a.currentPath());a.previewFile()&&a.previewFile(!1);c!==a.currentPath()&&a.itemsModel.loadList(c)};this.displayGrid=function(){a.viewMode("grid");a.previewFile(!1)};this.displayList=function(){a.viewMode("list");a.previewFile(!1)};this.createFolder=function(){l.prompt({message:h.prompt_foldername,value:h.default_foldername,okBtn:{label:h.create_folder,autoClose:!1,click:function(a,b){var c=
b.getInputValue();c?(c=S(c),d.ajax({type:"GET",url:q({mode:"addfolder",path:g.currentPath(),name:c}),dataType:"json",success:function(a){a.data&&(g.addItem(a.data,g.currentPath()),b.closeDialog(),e.options.showConfirmation&&l.success(h.successful_added_folder));t(a)},error:u})):l.error(h.no_foldername)}},cancelBtn:{label:h.cancel}})}};this.summaryModel=new function(){this.files=ko.observable(null);this.folders=ko.observable(null);this.size=ko.observable(null);this.enabled=ko.observable(!1);this.doSummarize=
function(){ra()}};this.searchModel=new function(){var c=this;this.value=ko.observable("");this.findAll=function(b,e){c.value(e.target.value);sa(function(){var b=c.value().toLowerCase();d.each(a.itemsModel.objects(),function(a,c){if("parent"!==c.rdo.type){var d=c.rdo.attributes.name,d=d.toLowerCase(),d=0===d.indexOf(b);c.visible(d)}})},200)};this.reset=function(b,e){c.value("");d.each(a.itemsModel.objects(),function(a,b){b.visible(!0)})}};this.clipboardModel=new function(){function c(){b=[];d=null}
var b=[],d=null,e=this,g=-1<z.indexOf("copy")||-1<z.indexOf("move");this.enabled=ko.observable(a.config().options.clipboard&&g);this.copy=function(){e.hasCapability("copy")&&(d="copy",b=a.itemsModel.getSelected())};this.cut=function(){e.hasCapability("cut")&&(d="cut",b=a.itemsModel.getSelected())};this.paste=function(){if(e.hasCapability("paste"))if(null===d||0===b.length)l.warning(h.clipboard_empty);else{var f=a.currentPath();J(b,function(a,b){if("cut"===d)return K(b,f);if("copy"===d)return ta(b,
f)},c)}};this.clear=function(){e.hasCapability("clear")&&(c(),l.success(h.clipboard_cleared))};this.isEmpty=function(){return 0===b.length};this.hasCapability=function(a){if(!e.enabled)return!1;switch(a){case "copy":return-1<z.indexOf("copy");case "cut":return-1<z.indexOf("move");default:return!0}}}},X=function(a){function c(a){var b=N;"list"===g.viewMode()&&(b=g.itemsModel.listSortField());switch(b){case "type":a=a.rdo.attributes.extension||"";break;case "size":a=a.rdo.attributes.size;break;case "modified":a=
a.rdo.attributes.timestamp;break;case "dimensions":a=a.cdo.dimensions||"";break;default:a=a.rdo.attributes.name}"string"===typeof a&&(d.cases||(a=a.toLowerCase()),a=a.replace(/\s+/g," "));return a}function b(a){for(var b=[],c=0,d=-1,e=0,f,k;f=(k=a.charAt(c++)).charCodeAt(0);)f=46==f||48<=f&&57>=f,f!==e&&(b[++d]="",e=f),b[d]+=k;return b}var d={natural:!0,order:"asc"===("list"===g.viewMode()?g.itemsModel.listSortOrder():O)?1:-1,cases:!1};a.sort(function(a,e){if("parent"===a.rdo.type||"parent"===e.rdo.type)return-1;
var f;f=c(a);var k=c(e);if(f===k)f=0;else if(void 0===f||void 0===k)f=0;else if(d.natural&&(isNaN(f)||isNaN(k)))a:{f=b(f.toString());for(var k=b(k.toString()),g=0;f[g]&&k[g];g++)if(f[g]!==k[g]){var h=Number(f[g]),l=Number(k[g]);f=h==f[g]&&l==k[g]?h-l:f[g]>k[g]?1:-1;break a}f=f.length-k.length}else f=f<k?-1:f>k?1:0;return f*=d.order});for(var f=[],h=a.length;h--;)"folder"===a[h].rdo.type&&(f.push(a[h]),a.splice(h,1));"top"!==e.options.folderPosition&&f.reverse();for(var h=0,l=f.length;h<l;h++)"top"===
e.options.folderPosition?a.unshift(f[h]):a.push(f[h]);return a},V=function(a){var c=null,c="user"===("undefined"===typeof a?"user":a)?0!=d.urlParam("config")?l.settings.baseUrl+"/config/"+d.urlParam("config"):l.settings.baseUrl+"/config/filemanager.config.json":l.settings.baseUrl+"/config/filemanager.config.default.json";return d.ajax({type:"GET",url:c,dataType:"json",cache:!1,error:function(a){l.error("Given config file ("+c+") does not exist!")}})},P=function(a){for(var c=0,b=a.length;c<b;c++)"string"===
typeof a[c]&&(a[c]=l.settings.baseUrl+a[c]);toast.apply(this,a)},W=function(a,c){return d.ajax({type:"GET",url:l.settings.baseUrl+"/scripts/templates/"+a+".html",error:u})},S=function(a,c){if(e.security.normalizeFilename){var b={" ":"_","'":"_","/":"","\\":""};a=a.replace(/[\s\S]/g,function(a){return b[a]||a})}e.options.charsLatinOnly&&("undefined"==typeof c&&(c=[]),a=getSlug(a,{separator:"_",maintainCase:!0,custom:c}),a=a.replace(/[^_a-zA-Z0-9]/g,""));return a=a.replace(/[_]+/g,"_")},ua=function(a){var c;
-1!=a.lastIndexOf(".")?(c=S(a.substr(0,a.lastIndexOf("."))),c+="."+a.split(".").pop()):c=S(a);return c},A=function(a,c){if(!a)return"";c=c||!1;for(var b=parseFloat(a),d=parseFloat(c?1E3:1024),e=0,g=[h.bytes,h.kb,h.mb,h.gb];;){if(b<d)return b=Math.round(100*b)/100,b+" "+g[e];b/=d;e+=1}},u=function(a){e.options.logger&&console.log(a.responseText||a);l.error(h.ERROR_SERVER);l.error(a.responseText)},t=function(a){a.errors&&d.each(a.errors,function(a,b){l.error(b.title)})},va=function(a){a=x(a);return""===
a&&!0===e.security.allowNoExtension||"DISALLOW_ALL"==e.upload.policy&&-1!==d.inArray(a,e.upload.restrictions)||"ALLOW_ALL"==e.upload.policy&&-1===d.inArray(a,e.upload.restrictions)?!0:!1},Q=function(a){return"/"!==a.charAt(a.length-1)},ca=function(a){var c=[];d.each(a.split("/"),function(a,d){c.push(encodeURIComponent(d))});return c.join("/")},x=function(a){return 1===a.split(".").length?"":a.split(".").pop().toLowerCase()},wa=function(a){return-1!==a.lastIndexOf(".")?a.substring(0,a.lastIndexOf(".")):
a},Z=function(a){return a.split("/").reverse().slice(2).reverse().join("/")+"/"},q=function(a){var c={time:(new Date).getTime()};a=d.extend({},a||{},c);return M+"?"+d.param(a)},G=function(a,c){c=c||!1;var b;b=a.attributes.path;e.viewer.absolutePath&&b?(c&&(b=ca(b)),b=da(b)):b=q({mode:"readfile",path:a.id});return b=l.settings.callbacks.beforeCreatePreviewUrl(a,b)},aa=function(a,c){var b;-1!==d.inArray(x(a.id),e.viewer.image.extensions)&&!a.attributes.read_protected&&(c&&e.viewer.image.showThumbs||
!c&&!0===e.viewer.image.enabled)&&(e.viewer.absolutePath&&!c&&a.attributes.path?b=da(ca(a.attributes.path)):(b={path:a.id},"svg"===a.attributes.extension?b.mode="readfile":(b.mode="getimage",c&&(b.thumbnail="true")),b=q(b)),b=l.settings.callbacks.beforeCreateImageUrl(a,b));return b},da=function(a){return("string"===typeof e.viewer.previewUrl?e.viewer.previewUrl:location.origin).replace(RegExp("^/+|/+$","g"),"")+a+"?time="+(new Date).getTime()},sa=function(){var a=0;return function(c,b){clearTimeout(a);
a=setTimeout(c,b)}}(),J=function(a,c,b){var e=0,f=a.length,g=d.Deferred().resolve();d.each(a,function(a,b){g=g.then(function(){return c(a,b)}).then(function(a){a&&a.data&&e++})});1<f&&g.then(function(){l.log(h.successful_processed.replace("%s",e).replace("%s",f))});g.then(function(){"function"===typeof b&&b()})},ba=function(a){var c=G(a,!0),c=l.settings.callbacks.beforeSelectItem(a,c);if(window.tinyMCEPopup)a=tinyMCEPopup.getWindowArg("window"),a.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=
c,"undefined"!=typeof a.ImageDialog&&(a.ImageDialog.getImageData&&a.ImageDialog.getImageData(),a.ImageDialog.showPreviewImage&&a.ImageDialog.showPreviewImage(c)),tinyMCEPopup.close();else{d.urlParam("field_name")&&(parent.document.getElementById(d.urlParam("field_name")).value=c,"undefined"!==typeof parent.tinyMCE&&parent.tinyMCE.activeEditor.windowManager.close(),"undefined"!==typeof parent.$.fn.colorbox&&parent.$.fn.colorbox.close());if(d.urlParam("ImperaviElementId")&&!window.opener){var b=d.urlParam("ImperaviElementId");
if(b=parent.$("#"+b).redactor("core.getObject"))b.modal.close(),b.buffer.set(),-1!==d.inArray(x(a.attributes.name),e.viewer.image.extensions)?b.insert.html('<img src="'+c+'">'):b.insert.html('<a href="'+c+'">'+a.attributes.name+"</a>")}d.urlParam("CKEditor")?window.opener?window.opener.CKEDITOR.tools.callFunction(d.urlParam("CKEditorFuncNum"),c):(parent.CKEDITOR.tools.callFunction(d.urlParam("CKEditorFuncNum"),c),parent.CKEDITOR.tools.callFunction(d.urlParam("CKEditorCleanUpFuncNum"))):window.opener&&
(a.attributes.width?window.opener.SetUrl(c,a.attributes.width,a.attributes.height):window.opener.SetUrl(c));l.settings.callbacks.afterSelectItem(a,c)}},xa=function(a){l.prompt({message:h.new_filename,value:e.security.allowChangeExtensions?a.attributes.name:wa(a.attributes.name),okBtn:{label:h.rename,autoClose:!1,click:function(c,b){var k=a.id,f=b.getInputValue();if(f){if(!e.security.allowChangeExtensions){var f=ua(f),m=x(a.attributes.name);0<m.length&&(f=f+"."+m)}Q(k)&&!va(f)?(f="<p>"+h.INVALID_FILE_TYPE+
"</p>","DISALLOW_ALL"==e.upload.policy&&(f+="<p>"+h.ALLOWED_FILE_TYPE+e.upload.restrictions.join(", ")+".</p>"),"ALLOW_ALL"==e.upload.policy&&(f+="<p>"+h.DISALLOWED_FILE_TYPE+e.upload.restrictions.join(", ")+".</p>"),d("#filepath").val(""),l.error(f)):d.ajax({type:"GET",url:q({mode:"rename",old:k,"new":f}),dataType:"json",success:function(a){if(a.data){var c=a.data,d=g.treeModel.findByParam("id",k);if(d&&("folder"===d.rdo.type&&(d.nodeTitle(c.attributes.name),g.treeModel.actualizeNodeObject(d,k,c.id)),
"file"===d.rdo.type)){var f=d.parentNode(),m=g.treeModel.createNode(c);d.remove();f&&g.treeModel.addNodes(f,m)}if(d=g.itemsModel.findByParam("id",k))"parent"===d.rdo.type?d.id=c.id:(d.remove(),g.itemsModel.addNew(c));g.currentPath()===k&&g.itemsModel.loadList(c.id);g.previewFile()&&g.previewModel.rdo.id===k&&g.previewModel.load(c);b.closeDialog();e.options.showConfirmation&&l.success(h.successful_rename)}t(a)},error:u})}else l.error(h.new_filename)}},cancelBtn:{label:h.cancel}})},ya=function(a){var c=
d("#fm-js-preview-toolbar"),b=c.find(":file");if("undefined"===typeof c.data("blueimpFileupload"))c.fileupload({autoUpload:!0,dataType:"json",url:q(),paramName:e.upload.paramName}).on("fileuploadadd",function(b,c){if(x(c.files[0].name)!=a.attributes.extension)return l.error(h.ERROR_REPLACING_FILE+" ."+a.attributes.extension),!1;c.submit()}).on("fileuploadsubmit",function(b,c){c.formData={mode:"replace",path:a.id};w.addClass("loading").prop("disabled",!0);w.children("span").text(h.loading_data)}).on("fileuploadalways",
function(a,b){w.removeData().removeClass("loading").prop("disabled",!1);w.children("span").text(h.upload);var c=b.result;c&&c.errors&&l.error(h.upload_failed+"<br>"+c.errors[0].title);c&&c.data&&(c=c.data[0],g.removeItem(c),g.addItem(c,g.currentPath()),g.previewFile()&&g.previewModel.load(c),e.options.showConfirmation&&l.success(h.successful_replace))}).on("fileuploadchunkdone",function(a,b){var c=b.result;c.data&&c.data[0]&&(c=c.data[0],g.removeItem(c),g.addItem(c,g.currentPath()))}).on("fileuploadfail",
function(a,c){l.error(h.upload_failed)});b.click()},za=function(a,c){var b=a.length,b=1<b?h.prompt_move_multiple.replace("%s",b):h.prompt_move;l.prompt({message:b,value:g.currentPath(),okBtn:{label:h.move,autoClose:!1,click:function(a,b){var d=b.getInputValue();d?(d=d.replace(RegExp("/+$","g"),"")+"/",c(d)):l.error(h.prompt_foldername)}},cancelBtn:{label:h.cancel},template:{dialogInput:'<input data-alertify-input type="text" value="" /><div class="prompt-info">'+h.help_move+"</div>"}})},ta=function(a,
c){return d.ajax({type:"GET",url:q({mode:"copy",source:a.id,target:c}),dataType:"json",success:function(a){console.log(a);a.data&&(g.addItem(a.data,c),alertify.clearDialogs(),e.options.showConfirmation&&l.success(h.successful_copied));t(a)},error:u})},K=function(a,c){return d.ajax({type:"GET",url:q({mode:"move",old:a.id,"new":c}),dataType:"json",success:function(b){if(b.data){var d=b.data;g.removeItem(a);g.addItem(d,c);g.currentPath()===a.id&&g.itemsModel.loadList(d.id);g.previewFile()&&g.previewModel.rdo.id===
a.id&&g.previewFile(!1);alertify.clearDialogs();e.options.showConfirmation&&l.success(h.successful_moved)}t(b)},error:u})},Aa=function(a,c){var b=a.length,b=1<b?h.confirm_delete_multiple.replace("%s",b):h.confirm_delete;l.confirm({message:b,okBtn:{label:h.yes,click:function(a,b){c()}},cancelBtn:{label:h.no}})},ea=function(a){return d.ajax({type:"GET",url:q({mode:"delete",path:a}),dataType:"json",success:function(a){if(a.data){var b=a.data;g.removeItem(b);g.previewFile()&&g.previewModel.rdo.id===b.id&&
g.previewFile(!1);e.options.showConfirmation&&l.success(h.successful_delete)}t(a)},error:u})},Ba=function(a){var c={mode:"download",path:a.id};return d.ajax({type:"GET",url:q(c),dataType:"json",success:function(a){a.data&&d.fileDownload(q(c));t(a)},error:u})},pa=function(a){d.ajax({type:"GET",url:q({mode:"editfile",path:a.id}),dataType:"json",success:function(c){c.data&&(g.previewModel.editor.enabled(!0),g.previewModel.editor.content(c.data.attributes.content),Ca(a.attributes.extension));t(c)},error:u})},
qa=function(a){a=g.previewModel.editor.codeMirror().getValue();g.previewModel.editor.content(a);d.ajax({type:"POST",url:q(),dataType:"json",data:d("#fm-js-editor-form").serializeArray(),success:function(a){a.data&&(g.previewModel.editor.enabled(!1),l.success(h.successful_edit));t(a)},error:u})},ra=function(){d.ajax({type:"GET",url:q({mode:"summarize"}),dataType:"json",success:function(a){if(a.data){var c=a.data.attributes,b=A(c.size,!0);if(0<c.sizeLimit)var e=A(c.sizeLimit,!0),b=b+(" ("+Math.round(100*
c.size/c.sizeLimit*100)/100+"%) "+h.of+" "+e);g.summaryModel.files(c.files);g.summaryModel.folders(c.folders);g.summaryModel.size(b);g.summaryModel.enabled(!0);c=d("#summary-popup").clone().show();g.summaryModel.enabled(!1);l.alert(c[0].outerHTML)}t(a)},error:u})},Y=function(a){if(a.attributes.read_protected)return l.error(h.NOT_ALLOWED_SYSTEM),!1;"file"===a.type&&g.previewModel.load(a);"folder"!==a.type&&"parent"!==a.type||g.itemsModel.loadList(a.id)},R=function(a,c,b){var e=b?b:[c];switch(a){case "select":ba(c);
break;case "download":d.each(e,function(a,b){Ba(b)});break;case "rename":xa(c);break;case "replace":ya(c);break;case "move":za(e,function(a){J(e,function(b,c){return K(c,a)})});break;case "delete":Aa(e,function(){J(e,function(a,b){return ea(b.id)})});break;case "copy":g.clipboardModel.copy();break;case "cut":g.clipboardModel.cut()}},na=function(){if(e.options.browseOnly)return!1;e.upload.multiple?(d("#file-input-container").remove(),w.unbind().click(function(){if(-1===z.indexOf("upload"))return l.error(h.NOT_ALLOWED),
!1;var a=null,c=g.currentPath(),b=tmpl("tmpl-fileupload-container",{folder:h.current_folder+c,info:h.upload_files_number_limit.replace("%s",e.upload.maxNumberOfFiles)+" "+h.upload_file_size_limit+A(e.upload.fileSizeLimit,!0),lang:h});"DISALLOW_ALL"==e.upload.policy&&(a=new RegExp("(\\.|\\/)("+e.upload.restrictions.join("|")+")$","i"));l.dialog({message:b,width:"auto",buttons:[{type:"ok",label:h.upload,autoClose:!1,click:function(a,b){0<f.children(".upload-item").length?f.find(".button-start").trigger("click"):
l.error(h.upload_choose_file)}},{label:h.select,closeOnClick:!1,click:function(a,b){d("#fileupload",k).trigger("click")}},{type:"cancel",label:h.close}]});var k=d(".fm-fileupload-container"),f=d(".dropzone",k),m=d(".dropzone-wrapper",k),n=d("#total-progress",k).children();e.customScrollbar.enabled&&m.mCustomScrollbar({theme:e.customScrollbar.theme,scrollButtons:{enable:e.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onOverflowY:function(){m.find(".mCSB_container").css({"margin-right":m.find(".mCSB_scrollTools").width()})},
onOverflowYNone:function(){m.find(".mCSB_container").css({"margin-right":"auto"})}},axis:"y"});m.on("click",function(a){(a.target===this||d(a.target).parent()[0]===this||a.target===f[0]||d(a.target).parent().hasClass("default-message"))&&d("#fileupload",k).trigger("click")});f.on("click",".button-start",function(a){a=d(this);a.parent().parent().data().submit();a.remove()});f.on("click",".button-abort",function(a){a=d(this).parent().parent().data();var b=a.files[0].context;a.abort();b.find(".error-message").text(h.upload_aborted);
b.addClass("aborted")});f.on("click",".button-resume",function(a){function b(b){d.blueimp.fileupload.prototype.options.add.call(d("#fileupload")[0],a,b);b.submit()}var e=d(this).parent().parent().data(),f=e.files[0];f.chunkUploaded?d.ajax({type:"GET",url:q({mode:"getfile",path:c+f.serverName}),dataType:"json",success:function(a){a.data&&(e.uploadedBytes=Number(a.data.attributes.size),e.uploadedBytes||(f.chunkUploaded=void 0),b(e));t(a)},error:u}):b(e)});f.on("click",".button-remove",function(a){a=
d(this);var b=a.parent().parent().data().files[0];b.chunkUploaded&&ea(c+b.serverName);a.closest(".upload-item").remove();p()});f.on("click",".button-info",function(a){a=d(this).closest(".upload-item");a.hasClass("error")&&(a=a.find(".error-message"),l.error(a.text()))});var p=function(){0<f.children(".upload-item").length?f.addClass("started"):f.removeClass("started")};d("#fileupload",k).fileupload({autoUpload:!1,sequentialUploads:!0,dataType:"json",dropZone:f,maxChunkSize:e.upload.chunkSize,url:q(),
paramName:e.upload.paramName,singleFileUploads:!0,formData:{mode:"upload",path:c},maxNumberOfFiles:e.upload.maxNumberOfFiles,acceptFileTypes:a,maxFileSize:e.upload.fileSizeLimit,messages:{maxNumberOfFiles:h.upload_files_number_limit.replace("%s",e.upload.maxNumberOfFiles),acceptFileTypes:h.upload_file_type_invalid,maxFileSize:h.upload_file_too_big+" "+h.upload_file_size_limit+A(e.upload.fileSizeLimit,!0)},previewMaxHeight:120,previewMaxWidth:120,previewCrop:!0}).on("fileuploadadd",function(a,b){var c=
f.children(".upload-item");d.each(b.files,function(a,g){if(c.length>=e.upload.maxNumberOfFiles)return l.error(h.upload_files_number_limit.replace("%s",e.upload.maxNumberOfFiles),{logClass:"fileuploadadd",unique:!0}),!1;g.formattedSize=A(g.size);var k=d(tmpl("tmpl-upload-item",{file:g,lang:h,imagesPath:l.settings.baseUrl+"/scripts/jQuery-File-Upload/img"}));g.context=k;k.find(".buttons").data(b);k.appendTo(f)});p()}).on("fileuploadsend",function(a,b){d.each(b.files,function(a,c){var d=c.context;d.removeClass("added aborted error").addClass("process");
c.chunkUploaded&&b.total===b.uploadedBytes&&d.remove()})}).on("fileuploadfail",function(a,b){d.each(b.files,function(a,b){b.error=h.upload_failed;b.context.removeClass("added process").addClass("error")})}).on("fileuploaddone",function(a,b){var c=b.result;d.each(b.files,function(a,b){var d=b.context;c&&c.errors?(d.removeClass("added process").addClass("error"),d.find(".error-message").text(c.errors[0].title),d.find(".button-start").remove()):d.remove()})}).on("fileuploadalways",function(a,b){var c=
b.result;d.each(b.files,function(a,b){if(c&&c.data&&c.data[a]){var d=c.data[a];g.removeItem(d);g.addItem(d,g.currentPath())}});var k=f.children(".upload-item");0===k.filter(".added").length&&0===k.filter(".process").length&&(0===k.length&&(alertify.clearDialogs(),e.options.showConfirmation&&l.success(h.upload_successful_files)),k.filter(".error").length&&l.error(h.upload_partially+"<br>"+h.upload_failed_details));p()}).on("fileuploadchunkdone",function(a,b){var c=b.result;d.each(b.files,function(a,
b){if(c.data&&c.data[a]){var d=c.data[a];g.removeItem(d);g.addItem(d,g.currentPath());b.serverName=d.attributes.name;b.chunkUploaded=1}})}).on("fileuploadprocessalways",function(a,b){d.each(b.files,function(a,b){var c=b.context;"undefined"!==typeof c&&(b.preview&&(c.find(".image").append(b.preview),c.find(".preview").removeClass("file-preview").addClass("image-preview")),b.error&&(c.removeClass("added process").addClass("error"),c.find(".error-message").text(b.error),c.find(".button-start").remove()))})}).on("fileuploadprogress",
function(a,b){d.each(b.files,function(a,c){var d=c.context,e=parseInt(b.loaded/b.total*100,10);d.find(".progress-bar").css("width",e+"%")})}).on("fileuploadprogressall",function(a,b){var c=parseInt(b.loaded/b.total*100,10);n.css("width",c+"%")})})):(w.click(function(){if(-1===z.indexOf("upload"))return l.error(h.NOT_ALLOWED),!1;var a=d(this).data();d.isEmptyObject(a)?l.error(h.upload_choose_file):a.submit()}),U.fileupload({autoUpload:!1,dataType:"json",url:q(),paramName:e.upload.paramName,maxChunkSize:e.upload.chunkSize}).on("fileuploadadd",
function(a,c){w.data(c)}).on("fileuploadsubmit",function(a,c){c.formData={mode:"upload",path:g.currentPath()};w.addClass("loading").prop("disabled",!0);w.children("span").text(h.loading_data)}).on("fileuploadalways",function(a,c){d("#filepath").val("");w.removeData().removeClass("loading").prop("disabled",!1);w.children("span").text(h.upload);var b=c.result;b&&b.errors&&l.error(h.upload_failed+"<br>"+b.errors[0].title);b&&b.data&&(b=b.data[0],g.removeItem(b),g.addItem(b,g.currentPath()),e.options.showConfirmation&&
l.success(h.upload_successful_file))}).on("fileuploadchunkdone",function(a,c){var b=c.result;b.data&&b.data[0]&&(b=b.data[0],g.removeItem(b),g.addItem(b,g.currentPath()))}).on("fileuploadfail",function(a,c){l.error(h.upload_failed)}))},Ca=function(a){function c(){var a=CodeMirror.fromTextArea(document.getElementById("fm-js-editor-content"),{styleActiveLine:!0,viewportMargin:Infinity,lineNumbers:e.viewer.editable.lineNumbers,lineWrapping:e.viewer.editable.lineWrapping,theme:e.viewer.editable.theme,
extraKeys:{F11:function(a){a.setOption("fullScreen",!a.getOption("fullScreen"))},Esc:function(a){a.getOption("fullScreen")&&a.setOption("fullScreen",!1)}}});a.setOption("mode",b);g.previewModel.editor.codeMirror(a)}var b,d=[];e.viewer.editable.codeHighlight?("txt"===a&&(b="default"),"js"===a&&(d.push("/scripts/CodeMirror/mode/javascript/javascript.js"),b="javascript"),"css"===a&&(d.push("/scripts/CodeMirror/mode/css/css.js"),b="css"),"html"===a&&(d.push("/scripts/CodeMirror/mode/xml/xml.js"),b="text/html"),
"xml"===a&&(d.push("/scripts/CodeMirror/mode/xml/xml.js"),b="application/xml"),"php"===a&&(d.push("/scripts/CodeMirror/mode/htmlmixed/htmlmixed.js"),d.push("/scripts/CodeMirror/mode/xml/xml.js"),d.push("/scripts/CodeMirror/mode/javascript/javascript.js"),d.push("/scripts/CodeMirror/mode/css/css.js"),d.push("/scripts/CodeMirror/mode/clike/clike.js"),d.push("/scripts/CodeMirror/mode/php/php.js"),b="application/x-httpd-php"),"sql"===a&&(d.push("/scripts/CodeMirror/mode/sql/sql.js"),b="text/x-mysql"),
"md"===a&&(d.push("/scripts/CodeMirror/addon/mode/overlay.js"),d.push("/scripts/CodeMirror/mode/xml/xml.js"),d.push("/scripts/CodeMirror/mode/markdown/markdown.js"),d.push("/scripts/CodeMirror/mode/gfm/gfm.js"),d.push("/scripts/CodeMirror/mode/javascript/javascript.js"),d.push("/scripts/CodeMirror/mode/css/css.js"),d.push("/scripts/CodeMirror/mode/htmlmixed/htmlmixed.js"),d.push("/scripts/CodeMirror/mode/clike/clike.js"),d.push("/scripts/CodeMirror/mode/meta.js"),b="gfm")):b="default";d.length?(d.push(c),
P(d)):c()};(function(){var a=d.Deferred();a.then(function(){return ha()}).then(function(a,b){return ia()}).then(function(){return ja()}).then(function(){return ka()}).then(function(){la(function(){oa()})});a.resolve()})();d(window).resize(l.setDimensions)}})(jQuery);$.fn.richFilemanager=function(d){return this.each(function(){if(void 0==$(this).data("richFilemanager")){var r=new $.richFilemanagerPlugin(this,d);$(this).data("richFilemanager",r)}})};
window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));
