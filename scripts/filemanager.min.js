!function(a){a.urlParam=function(a){var b=new RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.href);return b?b[1]:0},a.richFmPlugin=function(b,c){function d(b,c){return-1===x.indexOf(c)?!1:"dir"==b["File Type"]&&"replace"==c?!1:"dir"==b["File Type"]&&"select"==c?!1:"dir"==b["File Type"]&&"download"==c?s.security.allowFolderDownload===!0:"undefined"!=typeof b.Capabilities?a.inArray(c,b.Capabilities)>-1:!0}function e(b){var c={select:{name:t.select,className:"select"},download:{name:t.download,className:"download"},rename:{name:t.rename,className:"rename"},move:{name:t.move,className:"move"},replace:{name:t.replace,className:"replace"},separator1:"-----","delete":{name:t.del,className:"delete"}},e=b.data("itemdata");return d(e,"download")||delete c.download,d(e,"rename")&&s.options.browseOnly!==!0||delete c.rename,d(e,"delete")&&s.options.browseOnly!==!0||delete c["delete"],d(e,"move")&&s.options.browseOnly!==!0||delete c.move,d(e,"select")&&(window.opener||window.tinyMCEPopup||a.urlParam("field_name"))||delete c.select,delete c.replace,c}var f={pluginPath:"."},g=this,h=a(b),i=h.children(".fm-wrapper"),j=i.find(".fm-header"),k=j.find(".fm-uploader"),l=i.children(".fm-splitter"),m=i.children(".fm-footer"),n=l.children(".fm-fileinfo"),o=l.children(".fm-filetree"),p=k.children(".fm-upload"),q=[],r=[],s=null,t=null,u="/",v=null,w=null,x=[],y=null,z=null,A={},B=null,C=null;(new Date).getTime();g.settings={},g.log=function(b,c){var d=alertify,e=a.extend({},{reset:!0,delay:5e3,maxLogItems:5,logPosition:"bottom right",logContainerClass:"fm-log",closeLogOnClick:!0,parent:a(".fm-popup").is(":visible")?document.body:n[0],onClick:void 0,unique:!1,type:"default",logClass:""},c);return e.logClass&&e.unique&&a(".fm-log").children("."+e.logClass).length>0?d:(e.reset&&d.reset(),e.parent&&d.parent(e.parent),d.delay(e.delay),d.maxLogItems(e.maxLogItems),d.logPosition(e.logPosition),d.logContainerClass(e.logContainerClass),d.closeLogOnClick(e.closeLogOnClick),d.log(b,e.onClick,e.type+" "+e.logClass),d)},g.error=function(b,c){return g.log(b,a.extend({},{type:"error",delay:1e4},c))},g.success=function(b){return g.log(b,a.extend({},{type:"success",delay:6e3},c))},g.alert=function(a){alertify.reset().dialogContainerClass("fm-popup").alert(a)},g.confirm=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").confirm(a.message,a.okBtn,a.cancelBtn)},g.prompt=function(a){alertify.reset().defaultValue(a.value).dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").prompt(a.message,a.okBtn,a.cancelBtn)},g.dialog=function(a){alertify.reset().defaultValue(a.value).dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").dialog(a.message,a.buttons)},g.setDimensions=function(){var b=0,c=h.outerHeight(!0)-h.height();a.urlParam("CKEditorCleanUpFuncNum")&&(b+=60);var d=a(window).height()-j.height()-m.height()-c-b;l.height(d);var e=a(document).height()-a(window).height();if(!h.parent().is("body")&&e>0){var f=d-e;d=f>0?f:1,l.height(d)}var g=l.width()-l.children(".splitter-bar-vertical").outerWidth()-o.outerWidth();n.width(g)};var D=function(){E().then(function(a,b){return F()}).then(function(){return G()}).then(function(a){return H(),I()}).then(function(){J(),K()})},E=function(){return g.settings=a.extend(!0,f,c),a.when(M("default"),M("user")).done(function(b,c){var d=b[0],e=c[0];void 0!==e&&null!==e&&delete e.version,s=a.extend({},d,e)})},F=function(){function b(a){return d+a+".json"}var c=a.urlParam("langCode"),d=g.settings.pluginPath+"/scripts/languages/";return a.ajax().then(function(){return 0!=c?L(b(c)).done(function(){s.options.culture=c}).fail(function(){setTimeout(function(){g.error("Given language file ("+b(c)+") does not exist!")},500)}):void 0}).then(null,function(){var a=c.substring(0,2);return c!==a?L(b(a)).done(function(){setTimeout(function(){g.success("General language file ("+b(a)+") was loaded!")},500),s.options.culture=a}):void 0}).then(function(){return a.ajax({url:b(s.options.culture),dataType:"json"}).done(function(a){t=a})})},G=function(){return a.ajax({url:g.settings.pluginPath+"/"+s.icons.path+"/",success:function(b){a(b).find("a").attr("href",function(a,b){b.match(/\.(png)$/)&&r.push(b)})}})},H=function(){x=s.options.capabilities||["upload","select","download","rename","move","delete","replace"];var a=[];s.options.fileSorting&&(a=s.options.fileSorting.toLowerCase().split("_")),y=a[0]||"name",z=a[1]||"asc",v=s.options.baseUrl===!1?location.origin+location.pathname:s.options.baseUrl,aa(v).length>0&&(v=v.substring(0,v.lastIndexOf("/")+1)),v=$(v)+"/";var b="connectors/"+s.options.lang+"/filemanager."+s.options.lang;w=s.options.fileConnector||v+b},I=function(){return a.when(P("upload-container"),P("upload-item")).done(function(a,b){var c=a[0],d=b[0];i.append(c).append(d)})},J=function(){N("/themes/"+s.options.theme+"/styles/theme.css"),O("/scripts/zeroclipboard/dist/ZeroClipboard.js"),s.edit.enabled&&(N("/scripts/CodeMirror/lib/codemirror.css"),N("/scripts/CodeMirror/theme/"+s.edit.theme+".css"),O("/scripts/CodeMirror/lib/codemirror.js"),O("/scripts/CodeMirror/addon/selection/active-line.js"),N("/scripts/CodeMirror/addon/display/fullscreen.css"),O("/scripts/CodeMirror/addon/display/fullscreen.js"),O("/scripts/CodeMirror/dynamic-mode.js")),s.customScrollbar.enabled&&(N("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css"),O("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js")),s.options.browseOnly||(O("/scripts/jQuery-File-Upload/js/vendor/jquery.ui.widget.js"),O("/scripts/jQuery-File-Upload/js/canvas-to-blob.min.js"),O("/scripts/jQuery-File-Upload/js/load-image.all.min.js"),O("/scripts/jQuery-File-Upload/js/jquery.iframe-transport.js"),O("/scripts/jQuery-File-Upload/js/jquery.fileupload.js"),O("/scripts/jQuery-File-Upload/js/jquery.fileupload-process.js"),O("/scripts/jQuery-File-Upload/js/jquery.fileupload-image.js"),O("/scripts/jQuery-File-Upload/js/jquery.fileupload-validate.js"),s.upload.multiple&&N("/scripts/jQuery-File-Upload/css/dropzone.css")),s.options.charsLatinOnly&&O("/scripts/speakingurl/speakingurl.min.js")},K=function(){if(s.extras.extra_js)for(var b=0;b<s.extras.extra_js.length;b++)a.ajax({url:s.extras.extra_js[b],dataType:"script",async:s.extras.extra_js_async});a("#link-to-project").attr("href",s.url).attr("target","_blank").attr("title",t.support_fm+" ["+t.version+" : "+s.version+"]"),a("div.version").html(s.version),v=s.options.baseUrl===!1?location.origin+location.pathname:s.options.baseUrl,aa(v).length>0&&(v=v.substring(0,v.lastIndexOf("/")+1)),v=$(v)+"/";var c="connectors/"+s.options.lang+"/filemanager."+s.options.lang;w=s.options.fileConnector||v+c,0!=a.urlParam("exclusiveFolder")&&(u+=a.urlParam("exclusiveFolder"),Z(u)&&(u+="/"),u=u.replace(/\/\//g,"/"));var d="";0!=a.urlParam("expandedFolder")&&(d=a.urlParam("expandedFolder"),C=u+d),s.options.localizeGUI===!0&&(p.append(t.upload),j.find(".btn-grid").attr("title",t.grid_view),j.find(".btn-list").attr("title",t.list_view),j.find(".btn-newfolder").append(t.new_folder)),a.urlParam("CKEditorCleanUpFuncNum")&&(a("body").append('<button id="close-btn" type="button">'+t.close+"</button>"),a("#close-btn").click(function(){parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorCleanUpFuncNum"))})),a("#browse").append("+").attr("title",t.browse),a("#newfile").change(function(){a("#filepath").val(a(this).val().replace(/.+[\\\/]/,""))}),s.options.searchBox===!0?O("/scripts/filemanager.liveSearch.min.js"):a("#search").remove(),a("button").wrapInner("<span></span>"),n.data("view",s.options.defaultViewMode),S(s.options.defaultViewMode),a("#home").click(function(){Ba(),cb(u)}),a("#level-up").click(function(){var b=va(),c=a("#preview").length>0;if(b==u&&!c)return!1;var d=c?b:da(b);cb(d)}),j.find(".btn-grid").click(function(){S("grid"),n.data("view","grid"),cb(va())}),j.find(".btn-list").click(function(){S("list"),n.data("view","list"),cb(va())}),a("#summary").click(function(){a.getJSON(la({mode:"summarize"}),function(b){if(0==b.Code){var c=V(b.Size,!0),d=a("<div>",{"class":"summary-popup"});if(s.options.fileRootSizeLimit>0){var e=V(s.options.fileRootSizeLimit,!0),f=100*b.Size/s.options.fileRootSizeLimit,h=Math.round(100*f)/100;c+=" ("+h+"%) "+t.of+" "+e}d.append(a("<div>",{"class":"title",text:t.summary_title})),d.append(a("<div>",{"class":"line",text:t.summary_files+": "+b.Files})),b.Folders&&d.append(a("<div>",{"class":"line",text:t.summary_folders+": "+b.Folders})),d.append(a("<div>",{"class":"line",text:t.summary_size+": "+c})),g.alert(d[0].outerHTML)}else g.error(b.Error)}).error(function(a){X(a)})}),ta(u),s.upload.multiple?(a("#file-input-container").remove(),p.unbind().click(function(){if(-1===x.indexOf("upload"))return g.error(t.NOT_ALLOWED),!1;var b,c=va(),d=tmpl("tmpl-fileupload-container",{folder:t.current_folder+c,info:t.upload_files_number_limit.replace("%s",s.upload.numberOfFiles)+" "+t.upload_file_size_limit+V(s.upload.fileSizeLimit,!0),lang:t});b="DISALLOW_ALL"==s.security.uploadPolicy?new RegExp("(\\.|\\/)("+s.security.uploadRestrictions.join("|")+")$","i"):null,("images"==a.urlParam("type").toString().toLowerCase()||s.upload.imagesOnly)&&(b=new RegExp("(\\.|\\/)("+s.images.imagesExt.join("|")+")$","i")),g.dialog({message:d,width:"auto",buttons:[{type:"ok",label:t.upload,autoClose:!1,click:function(a,b){f.children(".upload-item").length>0?f.find(".button-start").trigger("click"):g.error(t.upload_choose_file)}},{label:t.select,closeOnClick:!1,click:function(b,c){a("#fileupload",e).trigger("click")}},{type:"cancel",label:t.close}]});var e=a(".fm-fileupload-container"),f=a(".dropzone",e),h=a(".dropzone-wrapper",e),i=a("#total-progress",e).children();s.customScrollbar.enabled&&h.mCustomScrollbar({theme:s.customScrollbar.theme,scrollButtons:{enable:s.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onOverflowY:function(){h.find(".mCSB_container").css({"margin-right":h.find(".mCSB_scrollTools").width()})},onOverflowYNone:function(){h.find(".mCSB_container").css({"margin-right":"auto"})}},axis:"y"}),h.on("click",function(b){(b.target===this||a(b.target).parent()[0]===this||b.target===f[0]||a(b.target).parent().hasClass("default-message"))&&a("#fileupload",e).trigger("click")}),f.on("click",".button-start",function(b){var c=a(this),d=c.parent().parent(),e=d.data();e.submit(),c.remove()}),f.on("click",".button-abort",function(b){var c=a(this),d=c.parent().parent(),e=d.data(),f=e.files[0].context;e.abort(),f.find(".error-message").text(t.upload_aborted),f.addClass("aborted")}),f.on("click",".button-resume",function(b){var d=a(this),e=d.parent().parent(),f=e.data(),g=f.files[0];g.chunkUploaded&&a.ajax({url:la({mode:"getinfo",path:c+g.serverName}),dataType:"json",async:!1,success:function(a){0==a.Code&&(f.uploadedBytes=Number(a.Properties.Size),f.uploadedBytes||(g.chunkUploaded=void 0))}}),a.blueimp.fileupload.prototype.options.add.call(a("#fileupload")[0],b,f),f.submit()}),f.on("click",".button-remove",function(b){var d=a(this),e=d.parent().parent(),f=e.data(),g=f.files[0];g.chunkUploaded&&a.getJSON(la({mode:"delete",path:c+g.serverName}),function(a){if(0==a.Code){var b=a.Path;Pa(b)}}),d.closest(".upload-item").remove(),j()}),f.on("click",".button-info",function(b){var c=a(this),d=c.closest(".upload-item");if(d.hasClass("error")){var e=d.find(".error-message");g.error(e.text())}});var j=function(){f.children(".upload-item").length>0?f.addClass("started"):f.removeClass("started")};a("#fileupload",e).fileupload({autoUpload:!1,sequentialUploads:!0,dataType:"json",dropZone:f,maxChunkSize:s.upload.chunkSize,url:la(),paramName:s.upload.paramName,formData:{mode:"add",currentpath:c},maxNumberOfFiles:s.upload.numberOfFiles,acceptFileTypes:b,maxFileSize:s.upload.fileSizeLimit,messages:{maxNumberOfFiles:t.upload_files_number_limit.replace("%s",s.upload.numberOfFiles),acceptFileTypes:t.upload_file_type_invalid,maxFileSize:t.upload_file_too_big+" "+t.upload_file_size_limit+V(s.upload.fileSizeLimit,!0)},previewMaxHeight:120,previewMaxWidth:120,previewCrop:!0}).on("fileuploadadd",function(b,c){var d=f.children(".upload-item");a.each(c.files,function(b,e){if(d.length>=s.upload.numberOfFiles)return g.error(t.upload_files_number_limit.replace("%s",s.upload.numberOfFiles),{logClass:"fileuploadadd",unique:!0}),!1;e.formattedSize=V(e.size);var h=a(tmpl("tmpl-upload-item",{file:e,lang:t,imagesPath:g.settings.pluginPath+"/scripts/jQuery-File-Upload/img"}));e.context=h,h.find(".buttons").data(c),h.appendTo(f)}),j()}).on("fileuploadsend",function(b,c){a.each(c.files,function(a,b){var d=b.context;d.removeClass("added aborted error").addClass("process"),b.chunkUploaded&&c.total===c.uploadedBytes&&d.remove()})}).on("fileuploadfail",function(b,c){a.each(c.files,function(a,b){b.error=t.upload_failed;var c=b.context;c.removeClass("added process").addClass("error")})}).on("fileuploaddone",function(b,c){a.each(c.files,function(a,b){var d,e=c.result,f=b.context;e.files&&e.files[a].error&&(d=e.files[a].error),"-1"==e.Code&&e.Error&&(d=e.Error),d?(f.removeClass("added process").addClass("error"),f.find(".error-message").text(d),f.find(".button-start").remove()):f.remove()})}).on("fileuploadalways",function(a,b){var d=f.children(".upload-item");0===d.filter(".added").length&&0===d.filter(".process").length&&(0===d.length&&(alertify.clearDialogs(),s.options.showConfirmation&&g.success(t.upload_successful_files)),d.filter(".error").length&&g.error(t.upload_partially+"<br>"+t.upload_failed_details),cb(c),Za(c)),j()}).on("fileuploadprocessalways",function(b,c){a.each(c.files,function(a,b){var c=b.context;"undefined"!=typeof c&&(b.preview&&(c.find(".image").append(b.preview),c.find(".preview").removeClass("file-preview").addClass("image-preview")),b.error&&(c.removeClass("added process").addClass("error"),c.find(".error-message").text(b.error),c.find(".button-start").remove()))})}).on("fileuploadprogress",function(b,c){a.each(c.files,function(a,b){var d=b.context,e=parseInt(c.loaded/c.total*100,10);d.find(".progress-bar").css("width",e+"%")})}).on("fileuploadprogressall",function(a,b){var c=parseInt(b.loaded/b.total*100,10);i.css("width",c+"%")}).on("fileuploadchunkdone",function(b,c){a.each(c.files,function(a,b){b.serverName=c.result.files[a].name,b.chunkUploaded=1})})})):(p.click(function(){if(-1===x.indexOf("upload"))return g.error(t.NOT_ALLOWED),!1;var b=a(this).data();a.isEmptyObject(b)?g.error(t.upload_choose_file):b.submit()}),k.fileupload({autoUpload:!1,dataType:"json",url:la(),paramName:s.upload.paramName}).on("fileuploadadd",function(a,b){p.data(b)}).on("fileuploadsubmit",function(a,b){b.formData={mode:"add",currentpath:va()},p.addClass("loading").prop("disabled",!0),p.children("span").text(t.loading_data)}).on("fileuploadalways",function(b,c){a("#filepath").val(""),p.removeData().removeClass("loading").prop("disabled",!1),p.children("span").text(t.upload);var d,e=c.result;if(e.files&&e.files[0].error&&(d=e.files[0].error),"-1"==e.Code&&e.Error&&(d=e.Error),d)g.error(t.upload_failed+"<br>"+d);else{var f=va();cb(f),Za(f),s.options.showConfirmation&&g.success(t.upload_successful_file)}}).on("fileuploadfail",function(a,b){g.error(t.upload_failed)})),s.customScrollbar.enabled?(o.append('<div style="height:3000px"></div>'),o.mCustomScrollbar({theme:s.customScrollbar.theme,scrollButtons:{enable:s.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onInit:function(){Ba()}},axis:"yx"}),n.mCustomScrollbar({theme:s.customScrollbar.theme,scrollButtons:{enable:s.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},axis:"y",alwaysShowScrollbar:0})):Ba(),1==s.options.browseOnly&&(a("#file-input-container").remove(),p.remove(),j.find(".btn-newfolder").remove(),a("#toolbar").remove("#rename"));var e=document.documentElement;if(e.setAttribute("data-useragent",navigator.userAgent),s.options.logger){(new Date).getTime()}setTimeout(function(){l.splitter({sizeLeft:s.options.splitterMinWidth,minLeft:s.options.splitterMinWidth,minRight:200});var b=h.find(".fm-loading-wrap");b.fadeOut(800),a(window).trigger("resize")},200),$a(u+d)},L=function(b){return a.ajax({type:"HEAD",url:b})},M=function(b){var c=null;return b="undefined"==typeof b?"user":b,"user"===b?0!=a.urlParam("config")?(c=g.settings.pluginPath+"/scripts/"+a.urlParam("config"),B=a.urlParam("config")):(c=g.settings.pluginPath+"/scripts/filemanager.config.json",B="filemanager.config.json"):c=g.settings.pluginPath+"/scripts/filemanager.config.default.json",a.ajax({url:c,dataType:"json",cache:!1,error:function(a){g.error("Given config file ("+c+") does not exist!")}})},N=function(b){return b=g.settings.pluginPath+b,-1===a.inArray(b,q)&&(a("<link>").attr({rel:"stylesheet",type:"text/css",href:b}).appendTo("head"),q.push(b)),null},O=function(b){b=g.settings.pluginPath+b,-1===a.inArray(b,q)&&(a("<script>").attr({type:"text/javascript",src:b}).appendTo("head"),q.push(b))},P=function(b,c){return a.ajax({url:g.settings.pluginPath+"/scripts/templates/"+b+".html",error:X})},Q=function(a){setTimeout(function(){a.mCustomScrollbar("update")},0)},R=function(a,b){if(b="undefined"==typeof b,s.options.showFullPath===!1){if(a=a.replace(u,"/"),"function"==typeof displayPathDecorator)return displayPathDecorator(a);if(a.length>50&&b===!0){var c=a.split("/");a="/"+c[1]+"/"+c[2]+"/(...)/"+c[c.length-2]+"/"}return a}return a},S=function(a){"grid"==a?(j.find(".btn-grid").addClass("active"),j.find(".btn-list").removeClass("active")):(j.find(".btn-list").addClass("active"),j.find(".btn-grid").removeClass("active"))},T=function(a,b){if(s.security.normalizeFilename){var c={" ":"_","'":"_","/":"","\\":""};a=a.replace(/[\s\S]/g,function(a){return c[a]||a})}return s.options.charsLatinOnly&&("undefined"==typeof b&&(b=[]),a=getSlug(a,{separator:"_",maintainCase:!0,custom:b}),a=a.replace(/[^_a-zA-Z0-9]/g,"")),a=a.replace(/[_]+/g,"_")},U=function(a){var b="";return-1!=a.lastIndexOf(".")?(b=T(a.substr(0,a.lastIndexOf("."))),b+="."+a.split(".").pop()):b=T(a),b},V=function(a,b){b=b||!1;for(var c=parseFloat(a),d=parseFloat(b?1e3:1024),e=0,f=[t.bytes,t.kb,t.mb,t.gb];;){if(d>c)return c=Math.round(100*c)/100,c+" "+f[e];c/=d,e+=1}},W=function(b){n.html("<h1>"+b+"</h1>"),a("#newfile").prop("disabled",!0),j.find(".btn-newfolder").prop("disabled",!0),p.prop("disabled",!0)},X=function(a){g.error(t.ERROR_SERVER)},Y=function(b){var c=aa(b);return""==c&&1==s.security.allowNoExtension?!0:"DISALLOW_ALL"==s.security.uploadPolicy&&-1!=a.inArray(c,s.security.uploadRestrictions)?!0:"ALLOW_ALL"==s.security.uploadPolicy&&-1==a.inArray(c,s.security.uploadRestrictions)},Z=function(a){return"/"!=a.charAt(a.length-1)},$=function(a){return a.replace(/^\/+|\/+$/g,"")},_=function(a,b){var c=a.replace(/^.*[\/\\]/g,"");return"string"==typeof b&&c.substr(c.length-b.length)==b&&(c=c.substr(0,c.length-b.length)),c},aa=function(a){return 1==a.split(".").length?"":a.split(".").pop().toLowerCase()},ba=function(a){return-1!=a.lastIndexOf(".")?a.substring(0,a.lastIndexOf(".")):a},ca=function(a){return a.lastIndexOf("/")!=a.length-1?a.substr(0,a.lastIndexOf("/")+1):a},da=function(a){return a.split("/").reverse().slice(2).reverse().join("/")+"/"},ea=function(a){return a.substring(0,a.slice(0,-1).lastIndexOf("/"))+"/"},fa=function(b){return-1!=a.inArray(aa(b),s.edit.editExt)},ga=function(b){return-1!=a.inArray(aa(b),s.images.imagesExt)},ha=function(b){return-1!=a.inArray(aa(b),s.videos.videosExt)},ia=function(b){return-1!=a.inArray(aa(b),s.audios.audiosExt)},ja=function(b){return-1!=a.inArray(aa(b),s.pdfs.pdfsExt)},ka=function(b){return-1!=a.inArray(aa(b),s.docs.docsExt)},la=function(b){var c={config:B,time:(new Date).getTime()},d=a.extend({},b||{},c);return w+"?"+a.param(d)},ma=function(a){return la({mode:"readfile",path:a})},na=function(a,b){var c,d=g.settings.pluginPath+"/"+s.icons.path;if(Z(a.Path))if(1==a.Protected)c=d+"locked_"+s.icons.folder;else{var e=aa(a.Path),f=ga(a.Path),h=e+".png";if(c=d+s.icons["default"],f&&s.options.showThumbs||-1===r.indexOf(h)||(c=d+h),f){var i={path:a.Path};"svg"===e?i.mode="readfile":(i.mode="getimage",b&&(i.thumbnail="true")),c=la(i)}}else c=d+(1==a.Protected?"locked_":"")+s.icons.folder;return c},oa=function(a){var b=ma(a.Path),c='<video src="'+b+'" width='+s.videos.videosPlayerWidth+" height="+s.videos.videosPlayerHeight+' controls="controls"></video>';n.find("img").remove(),n.find("#preview #main-title").before(c)},pa=function(a){var b=ma(a.Path),c='<audio src="'+b+'" controls="controls"></audio>';n.find("img").remove(),n.find("#preview #main-title").before(c)},qa=function(a){var b=ma(a.Path),c='<iframe id="fm-pdf-viewer" src="'+g.settings.pluginPath+"/scripts/ViewerJS/index.html#"+b+'" width="'+s.pdfs.pdfsReaderWidth+'" height="'+s.pdfs.pdfsReaderHeight+'" allowfullscreen webkitallowfullscreen></iframe>';n.find("img").remove(),n.find("#preview #main-title").before(c)},ra=function(a){var b=encodeURIComponent(ma(a.Path)),c='<iframe id="fm-google-viewer" src="http://docs.google.com/viewer?url='+b+'&embedded=true" width="'+s.docs.docsReaderWidth+'" height="'+s.docs.docsReaderHeight+'" allowfullscreen webkitallowfullscreen></iframe>';n.find("img").remove(),n.find("#preview #main-title").before(c)},sa=function(b){n.find("tr.file, tr.directory").each(function(){var c=a(this).attr("data-path"),d=o.find('a[data-path="'+c+'"]').parent();"undefined"!=typeof d.css("background-image")&&(a(this).find("td:first").css("background-image",d.css("background-image")),window.clearInterval(b))})},ta=function(b){wa(b),j.find(".btn-newfolder").unbind().click(function(){var b=function(b,c){var d=c.getInputValue();return d?(d=T(d),void a.getJSON(la({mode:"addfolder",path:va(),name:d}),function(a){0==a.Code?(Ma(a.Parent),cb(a.Parent),c.closeDialog(),s.options.showConfirmation):g.error(a.Error)})):void g.error(t.no_foldername)};g.prompt({message:t.prompt_foldername,value:t.default_foldername,okBtn:{label:t.create_folder,autoClose:!1,click:b},cancelBtn:{label:t.cancel}})})},ua=function(b){n.find("button").each(function(b){0==a(this).find("span").length&&a(this).wrapInner("<span></span>")}),d(b,"select")?(n.find("button#select").click(function(){Ca(b)}).show(),(window.opener||window.tinyMCEPopup)&&a("#preview").find("img").attr("title",t.select).css("cursor","pointer").click(function(){Ca(b)})):n.find("button#select").hide(),d(b,"rename")?n.find("button#rename").click(function(){Da(b)}).show():n.find("button#rename").hide(),d(b,"move")?n.find("button#move").click(function(){Fa(b)}).show():n.find("button#move").hide(),d(b,"replace")?n.find("button#replace").click(function(){Ea(b)}).show():n.find("button#replace").hide(),d(b,"delete")?n.find("button#delete").click(function(){Ha(b)}).show():n.find("button#delete").hide(),d(b,"download")?n.find("button#download").click(function(){Ia(b)}).show():n.find("button#download").hide(),n.find("#parentfolder").click(function(a){cb(va())})},va=function(){var a=j.find(".current-path");return a.find("input:hidden").val()},wa=function(a){var b=j.find(".current-path");b.find("input:hidden").val(a),b.find("h1").text(t.current_folder+R(a)).attr("title",R(a,!1))},xa=function(a){return a.find(".mCSB_container").length>0?a.find(".mCSB_container"):a},ya=function(a){return"grid"==n.data("view")?n.find('li[data-path="'+a+'"]'):n.find('tr[data-path="'+a+'"]')},za=function(){var b,c="grid"==n.data("view"),d=c?"li":"tbody > tr",e=0;b=n.find(d+".file, "+d+".directory").not(".ui-draggable-dragging").length,n.find(d+".file").not(".ui-draggable-dragging").each(function(){var b=a(this).data("itemdata");e+=Number(b.Properties.Size)}),a("#items-counter").text(b+" "+t.items),a("#items-size").text(t.size+": "+V(e))},Aa=function(b){1==s.options.searchBox&&(a("#q").liveUpdate("#filetree ul").blur(),a("#search span.q-inactive").html(t.search),a("#search a.q-reset").attr("title",t.search_reset)),b.find("li.file, li.directory").draggable({distance:10,cursor:"move",helper:function(){var b=a(this).clone();return b.find("ul").remove(),b}}),b.find("li.directory > a").droppable({accept:function(b){return b.is("li.file, li.directory")&&!b.parent().prev("a").is(a(this))},hoverClass:"drop-hover",drop:function(b,c){var d=c.draggable.find("a").attr("data-path"),e=a(b.target).attr("data-path");Ga(d,e)}})},Ba=function(){var b=xa(o),c=!1;b.data("fileTree")&&(c=!0,b.unbind().data("fileTree",null).children("ul.jqueryFileTree").remove());var d=function(a,b){c||(a.expandSpeed=b?300:0,a.collapseSpeed=b?300:0)},f=function(b,c){if(null!==C){var e=!1;b.find("li.directory.collapsed").each(function(b,f){var g=a(f).children();0===C.indexOf(g.attr("data-path"))&&(e=!0,d(c.options,!1),setTimeout(function(){g.click()},50))}),e===!1&&(C=null,d(c.options,!0))}};b.on("filetreeinitiated",function(b,c){var d=a(b.target).find("ul");f(d,c)}).on("filetreeexpand",function(a,b){cb(b.rel)}).on("filetreeexpanded",function(a,b){var c=b.li.children("ul");f(c,b),C==b.rel&&(C=null,d(b.options,!0))}).fileTree({root:u,script:eb,multiFolder:!0,expandSpeed:300,collapseSpeed:300,errorMessage:null},function(a){ab(a)}),b.contextMenu({selector:"li a",build:function(a,b){return{appendTo:".fm-container",items:e(a),callback:function(a,b){var c=b.$trigger.attr("data-path");_a(a,c)}}}})},Ca=function(b){var c=ma(b.Path);if(window.opener||window.tinyMCEPopup||a.urlParam("field_name")||a.urlParam("CKEditorCleanUpFuncNum")||a.urlParam("CKEditor")||a.urlParam("ImperaviElementId")){if(window.tinyMCEPopup){var d=tinyMCEPopup.getWindowArg("window");return d.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=c,"undefined"!=typeof d.ImageDialog&&(d.ImageDialog.getImageData&&d.ImageDialog.getImageData(),d.ImageDialog.showPreviewImage&&d.ImageDialog.showPreviewImage(c)),void tinyMCEPopup.close()}if(a.urlParam("field_name"))parent.document.getElementById(a.urlParam("field_name")).value=c,"undefined"!=typeof parent.tinyMCE&&parent.tinyMCE.activeEditor.windowManager.close(),"undefined"!=typeof parent.$.fn.colorbox&&parent.$.fn.colorbox.close();else if(a.urlParam("ImperaviElementId"))if(window.opener);else{var e=a.urlParam("ImperaviElementId"),f=parent.$("#"+e).redactor("core.getObject");f&&(f.modal.close(),f.buffer.set(),ga(b.Filename)?f.insert.html('<img src="'+c+'">'):f.insert.html('<a href="'+c+'">'+b.Filename+"</a>"))}else if(a.urlParam("CKEditor"))window.opener?window.opener.CKEDITOR.tools.callFunction(a.urlParam("CKEditorFuncNum"),c):(parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorFuncNum"),c),parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorCleanUpFuncNum")));else if(""!=b.Properties.Width){var h=c,i=b.Properties.Width,j=b.Properties.Height;window.opener.SetUrl(h,i,j)}else window.opener.SetUrl(c);window.opener&&window.close()}else g.error(t.fck_select_integration)},Da=function(b){var c=function(c,d){var e=d.getInputValue();if(!e)return void g.error(t.new_filename);if(!s.security.allowChangeExtensions){e=U(e);var f=aa(b.Filename);f.length>0&&(e=e+"."+f)}if(Z(b.Path)&&!Y(e)){var h="<p>"+t.INVALID_FILE_TYPE+"</p>";return"DISALLOW_ALL"==s.security.uploadPolicy&&(h+="<p>"+t.ALLOWED_FILE_TYPE+s.security.uploadRestrictions.join(", ")+".</p>"),"ALLOW_ALL"==s.security.uploadPolicy&&(h+="<p>"+t.DISALLOWED_FILE_TYPE+s.security.uploadRestrictions.join(", ")+".</p>"),a("#filepath").val(""),void g.error(h)}a.ajax({type:"GET",url:la({mode:"rename",old:b.Path,"new":e}),dataType:"json",async:!1,success:function(a){if(0==a.Code){var b=a["New Path"],c=a["New Name"],e=a["Old Path"],f=ca(b),h=ca(e),i=va(),j=n.find("#main-title > h1"),k=j.length>0;if(Na(e,b,c),0===f.indexOf(i))if(Z(b)&&aa(b)!==aa(e)){var l=k?b:f;$a(l)}else k&&e===j.attr("title")?Qa(b):k||Ra(ya(e),b,c);else if(0===i.indexOf(h)){var m=new RegExp("^"+h),o=va().replace(m,f);if(wa(o),k)Qa(o);else{var p="grid"==n.data("view")?"li":"tbody > tr";Ta(e,b,n.find(p))}}Xa(),za(),d.closeDialog(),s.options.showConfirmation&&g.success(t.successful_rename)}else g.error(a.Error)},error:X})};g.prompt({message:t.new_filename,value:s.security.allowChangeExtensions?b.Filename:ba(b.Filename),okBtn:{label:t.rename,autoClose:!1,click:c},cancelBtn:{label:t.cancel}})},Ea=function(b){var c=a("#toolbar"),d=c.find("#replacement");"undefined"==typeof c.data("blueimpFileupload")&&c.fileupload({autoUpload:!0,dataType:"json",url:la(),paramName:s.upload.paramName}).on("fileuploadadd",function(a,c){var d=c.files[0];return aa(d.name)!=b["File Type"]?(g.error(t.ERROR_REPLACING_FILE+" ."+b["File Type"]),!1):void c.submit()}).on("fileuploadsubmit",function(a,c){c.formData={mode:"replace",newfilepath:b.Path},p.addClass("loading").prop("disabled",!0),p.children("span").text(t.loading_data)}).on("fileuploadalways",function(b,c){p.removeData().removeClass("loading").prop("disabled",!1),p.children("span").text(t.upload);var d,e=c.result;if(e.files&&e.files[0].error&&(d=e.files[0].error),"-1"==e.Code&&e.Error&&(d=e.Error),d)g.error(t.upload_failed+"<br>"+d);else{var f=n.find("#main-title > h1").attr("title"),h=va();ab(f),Za(h),a("#preview").find("img").hide().fadeIn("slow"),o.find('a[data-path="'+f+'"]').parent().hide().fadeIn("slow"),s.options.showConfirmation&&g.success(t.successful_replace)}}).on("fileuploadfail",function(a,b){g.error(t.upload_failed)}),d.click()},Fa=function(b){var c=function(c,d){var e=a(d.dialog).find("[data-alertify-input]").val();""!=e?Ga(b.Path,e):g.error(t.prompt_foldername)},d="<div data-alertify-msg>"+t.move+'</div><input data-alertify-input type="text" value="" /><div class="prompt-info">'+t.help_move+"</div>";g.dialog({message:d,buttons:[{type:"ok",label:t.move,autoClose:!1,click:c},{type:"cancel",label:t.cancel}]})},Ga=function(b,c){a.ajax({type:"GET",url:la({mode:"move",old:b,"new":c}),dataType:"json",async:!1,success:function(c){if(0==c.Code){var d=c["New Path"],e=c["New Name"],f=va();if(Oa(d,e,b),f===d&&cb(d),f===ca(b)){var h=Z(b)?d:d+e+"/";if(f===b&&wa(h),a("#preview").length>0)Qa(h);else{var i="grid"==n.data("view")?"li":"tbody > tr";Ta(b,h,n.find(i))}Xa(),za()}ui.closeDialog(),s.options.showConfirmation&&g.success(t.successful_moved)}else g.error(c.Error)},error:X})},Ha=function(b){var c=!1,d=function(d,e){a.ajax({type:"GET",url:la({mode:"delete",path:b.Path}),dataType:"json",async:!1,success:function(a){if(0==a.Code){var b=a.Path,d=n.find("#main-title > h1"),e=d.length>0;if(Pa(b),c=!0,b===va()){var f=ea(b);wa(f),$a(f)}else Z(b)&&e&&b===d.attr("title")&&$a(ca(b));s.options.showConfirmation&&g.success(t.successful_delete)}else c=!1,g.error(a.Error)},error:X})};return g.confirm({message:t.confirmation_delete,okBtn:{label:t.yes,click:d},cancelBtn:{label:t.no}}),c},Ia=function(b){var c={mode:"download",path:b.Path};a.ajax({type:"GET",url:la(c),dataType:"json",async:!1,success:function(a){0==a.Code?(c.force="true",window.location=la(c)):g.error(a.Error)},error:X})},Ja=function(b){var c=!1;return n.find("div#tools").append(' <a id="edit-file" href="#" title="'+t.edit+'"><span>'+t.edit+"</span></a>"),a("#edit-file").click(function(){a(this).hide(),a.ajax({type:"GET",url:la({mode:"editfile",path:b.Path}),dataType:"json",async:!1,success:function(d){if(0==d.Code){var e,f=a("#preview"),h='<form id="edit-form">';h+='<textarea id="edit-content" name="content">'+d.Content+"</textarea>",h+='<input type="hidden" name="mode" value="savefile" />',h+='<input type="hidden" name="path" value="'+b.Path+'" />',h+='<button id="edit-cancel" class="edition" type="button">'+t.quit_editor+"</button>",h+='<button id="edit-save" class="edition" type="button">'+t.save+"</button>",h+="</form>",f.find("img").hide(),f.prepend(h).hide().fadeIn(),Q(n),a("#edit-cancel").click(function(){f.find("form#edit-form").hide(),f.find("img").fadeIn(),a("#edit-file").show()}),a("#edit-save").click(function(){var b=e.getValue();a("textarea#edit-content").val(b);var d=a("#edit-form").serializeArray();a.ajax({type:"POST",url:la(),dataType:"json",data:d,async:!1,success:function(a){0==a.Code?(c=!0,s.options.showConfirmation&&g.success(t.successful_edit)):(c=!1,
g.error(a.Error))},error:X})}),e=instantiateCodeMirror(aa(b.Path),s,O)}else c=!1,g.error(d.Error),a(this).show()}})}),c},Ka=function(b,c){c=c||0,ya(b).not(".directory-parent").fadeOut(c,function(){a(this).remove(),za()})},La=function(b,c){c=c||0,o.find('a[data-path="'+b+'"]').parent().fadeOut(c,function(){a(this).remove()})},Ma=function(a){Za(a),s.options.showConfirmation&&g.success(t.successful_added_folder)},Na=function(a,b,c){var d=o.find('a[data-path="'+a+'"]');Z(b)?aa(b)!==aa(a)?Ya(ca(b),a,b):Sa(d,b,c):(Sa(d,b,c),Ta(a,b,d.next("ul").find("a"))),Wa(o.find('a[data-path="'+b+'"]').parent().parent())},Oa=function(a,b,c,d){d=d||!1;var e=va(),f=o.find('a[data-path="'+a+'"]'),g=f.next("ul"),h=g.parent();if(Ka(c),d&&(C=a,Ba()),a===u&&(g=xa(o).children("ul"),h=o),0===g.length)return e===c&&(xa(o).data("fileTree").options.expandSpeed=0,f.click()),void La(c);e===a&&(g.is(":hidden")&&g.show().parent().addClass("expanded").removeClass("collapsed"),cb(a));var i=o.find('a[data-path="'+c+'"]').parent().not(".ui-draggable-dragging");Ta(ea(c),a,i.find("a")),i.appendTo(g),Wa(g),Aa(h)},Pa=function(a){Ka(a),La(a)},Qa=function(b){var c=a("#toolbar"),d=n.find("#main-title > h1"),e=_(b)||d.text(),f=ca(b)+e;d.text(e).attr("title",f);var g=c.data("fmitem");g.Path=f,g.Filename=e,c.find("button").unbind(),ua(g)},Ra=function(a,b,c){var d=a.data("itemdata");d.Path=b,"undefined"!=typeof c&&(d.Filename=c,Z(c)&&(d["File Type"]=aa(c))),a.attr("data-path",b),"grid"==n.data("view")?(a.find("img").attr("alt",b),a.children("p").text(d.Filename)):a.find("td:first").text(d.Filename)},Sa=function(a,b,c){var d=a.data("itemdata");d.Path=b,"undefined"!=typeof c&&(d.Filename=c,Z(c)&&(d["File Type"]=aa(c))),a.attr("data-path",b).attr("rel",b),a.text(d.Filename)},Ta=function(b,c,d){var e=new RegExp("^"+b);d.each(function(){var b=a(this).attr("data-path"),d=b.replace(e,c);a(this).is("a")?Sa(a(this),d):a(this).hasClass("directory-parent")?a(this).attr("data-path",da(va())):Ra(a(this),d)})},Ua=function(b){var c=y,d=a(b).data("itemdata");if("list"==n.data("view")){var e=n.data("list-sort");e&&(c=e.column)}switch(c){case"type":return d["File Type"];case"size":return d.Properties.Size;case"modified":return d.Properties.filemtime;case"dimensions":return d.Properties.Width+"x"+d.Properties.Height;default:return d.Filename}},Va=function(a,b){"bottom"===s.options.folderPosition&&a.find(b+".directory").appendTo(a),"top"===s.options.folderPosition&&(a.find(b+".directory").prependTo(a),a.find(b+".directory-parent").prependTo(a))},Wa=function(a){var b=a.find("> li");0!==b.length&&(b.tsort({selector:"a",callback:Ua,order:z,natural:!0}),Va(a,"> li"))},Xa=function(){var a,b=n.find("#contents");if("grid"==n.data("view")){if(a=b.find("li.file, li.directory"),0===a.length)return;a.tsort({callback:Ua,order:z,natural:!0}),Va(b,"li")}else{var c,d,e,f=n.data("list-sort"),g=b.find("th");if(d=f?f.order:z,c=f?f.column:y,e=g.filter(".column-"+c),g.removeClass("sorted sorted-asc sorted-desc"),e.addClass("sorted sorted-"+d),a=b.find("tr.file, tr.directory"),0===a.length)return;a.tsort({callback:Ua,order:d,natural:!0}),Va(b,"tr")}},Ya=function(a,b,c){var d=o.find('a[data-path="'+b+'"]').parent(),e=eb({dir:ca(a)},c);d.replaceWith(e)},Za=function(b){var c,d=b===u;if(c=d?xa(o).children("ul"):o.find('a[data-path="'+b+'"]').next("ul"),d||c.parent().hasClass("expanded")){var e=eb({dir:b}),f=c.find(">li>a").map(function(){return this.getAttribute("data-path")}).get();e.find(">li>a").each(function(){-1===f.indexOf(a(this).attr("data-path"))&&c.append(a(this).parent())}),Wa(c),Aa(c)}else xa(o).data("fileTree").options.expandSpeed=0,c.prev("a").click()},$a=function(a){if(Z(a))ab(a);else{cb(a);var b=o.find('a[data-path="'+a+'"]');b.parent().hasClass("collapsed")&&b.click()}},_a=function(b,c){a.getJSON(la({mode:"getinfo",path:c}),function(a){switch(b){case"select":Ca(a);break;case"download":Ia(a);break;case"rename":Da(a);break;case"replace":Ea(a);break;case"move":Fa(a);break;case"delete":Ha(a)}})},ab=function(b){a(".context-menu-root").hide();var c=b.substr(0,b.lastIndexOf("/")+1);ta(c),a.getJSON(la({mode:"getinfo",path:b}),function(c){if("-1"==c.Code)return void W(c.Error);var d='<div id="preview"><img /><div id="main-title"><h1></h1><div id="tools"></div></div><dl></dl></div>';if(d+='<form id="toolbar">',d+='<button id="parentfolder" type="button">'+t.parentfolder+"</button>",-1!=a.inArray("select",x)&&(a.urlParam("CKEditor")||window.opener||window.tinyMCEPopup||a.urlParam("field_name")||a.urlParam("ImperaviElementId"))&&(d+='<button id="select" name="select" type="button">'+t.select+"</button>"),-1!=a.inArray("download",x)&&(d+='<button id="download" name="download" type="button">'+t.download+"</button>"),-1!=a.inArray("rename",x)&&1!=s.options.browseOnly&&(d+='<button id="rename" name="rename" type="button">'+t.rename+"</button>"),-1!=a.inArray("move",x)&&1!=s.options.browseOnly&&(d+='<button id="move" name="move" type="button">'+t.move+"</button>"),-1!=a.inArray("delete",x)&&1!=s.options.browseOnly&&(d+='<button id="delete" name="delete" type="button">'+t.del+"</button>"),-1!=a.inArray("replace",x)&&1!=s.options.browseOnly&&(d+='<button id="replace" name="replace" type="button">'+t.replace+"</button>",d+='<div class="hidden-file-input"><input id="replacement" name="replacement" type="file" /></div>'),d+="</form>",xa(n).html(d),n.find("img").attr("src",na(c)),n.find("#main-title > h1").text(c.Filename).attr("title",b),ha(c.Filename)&&1==s.videos.showVideoPlayer&&oa(c),ia(c.Filename)&&1==s.audios.showAudioPlayer&&pa(c),ja(c.Filename)&&1==s.pdfs.showPdfReader&&qa(c),ka(c.Filename)&&1==s.docs.showGoogleViewer&&ra(c),fa(c.Filename)&&1==s.edit.enabled&&0==c.Protected&&Ja(c),0==c.Protected){n.find("div#tools").append('<a id="copy-button" data-clipboard-text="'+ma(c.Path)+'" title="'+t.copy_to_clipboard+'" href="#"><span>'+t.copy_to_clipboard+"</span></a>"),ZeroClipboard.config({swfPath:g.settings.pluginPath+"/scripts/zeroclipboard/dist/ZeroClipboard.swf"});var e=new ZeroClipboard(document.getElementById("copy-button"));e.on("ready",function(a){e.on("aftercopy",function(a){})}),a("#copy-button").click(function(){n.find("div#tools").append('<span id="copied">'+t.copied+"</span>"),a("#copied").delay(500).fadeOut(1e3,function(){a(this).remove()})})}var f="";0==c.Protected&&(c.Properties.Width&&""!=c.Properties.Width&&(f+="<dt>"+t.dimensions+"</dt><dd>"+c.Properties.Width+"x"+c.Properties.Height+"</dd>"),c.Properties["Date Created"]&&""!=c.Properties["Date Created"]&&(f+="<dt>"+t.created+"</dt><dd>"+c.Properties["Date Created"]+"</dd>"),c.Properties["Date Modified"]&&""!=c.Properties["Date Modified"]&&(f+="<dt>"+t.modified+"</dt><dd>"+c.Properties["Date Modified"]+"</dd>"),(c.Properties.Size||0==parseInt(c.Properties.Size))&&(f+="<dt>"+t.size+"</dt><dd>"+V(c.Properties.Size)+"</dd>")),n.find("dl").html(f),a("#toolbar").data("fmitem",c),ua(c)})},bb=function(b){var c=a.extend({},b);return delete c.Error,delete c.Code,c},cb=function(b){ta(b);var c,f,h,i,j=xa(n),k='<div class="loading-view"></div>';j.html(k);var l="",m=db(b);if("-1"==m.Code)return void W(m.Error);if(m)if("grid"==n.data("view")){var o=a("<ul>",{id:"contents","class":"grid"});Z(b)||b===u||(h='<li class="directory-parent" data-path="'+da(b)+'" oncontextmenu="return false;">',h+='<div class="clip"><img src="'+g.settings.pluginPath+"/"+s.icons.path+"/"+s.icons.parent+'" alt="Parent" /></div>',h+="</li>",o.append(h));for(var p in m){c=m[p],i=c.Properties;var q=64,r=i.Width;r>1&&q>r&&(q=r);var v=a("<li>",{"class":"dir"==c["File Type"]?"directory":"file",title:s.options.showTitleAttr?c.Path:null,"data-path":c.Path}).data("itemdata",bb(c));f='<div class="clip"><img src="'+na(c,!0)+'" width="'+q+'" alt="'+c.Path+'" /></div>',f+="<p>"+c.Filename+"</p>",i.Width&&""!=i.Width&&(f+='<span class="meta dimensions">'+i.Width+"x"+i.Height+"</span>"),i.Size&&""!=i.Size&&(f+='<span class="meta size">'+i.Size+"</span>"),i["Date Created"]&&""!=i["Date Created"]&&(f+='<span class="meta created">'+i["Date Created"]+"</span>"),i["Date Modified"]&&""!=i["Date Modified"]&&(f+='<span class="meta modified">'+i["Date Modified"]+"</span>"),o.append(v.append(f))}l=o}else{var w=a("<table>",{id:"contents","class":"list"}),x='<thead><tr class="rowHeader">';x+='<th class="column-name" data-colname="name"><span>'+t.name+"</span></th>",x+='<th class="column-type" data-colname="type"><span>'+t.type+"</span></th>",x+='<th class="column-dimensions" data-colname="dimensions"><span>'+t.dimensions+"</span></th>",x+='<th class="column-size" data-colname="size"><span>'+t.size+"</span></th>",x+='<th class="column-modified" data-colname="modified"><span>'+t.modified+"</span></th>",x+="</tr></thead>",w.append(x),w.append("<tbody>"),Z(b)||b===u||(h='<tr class="directory-parent" data-path="'+da(b)+'" oncontextmenu="return false;">',h+="<td>..</td>",h+="<td></td>",h+="<td></td>",h+="<td></td>",h+="<td></td>",h+="</tr>",w.append(h));for(var p in m){c=m[p],i=c.Properties;var y=a("<tr>",{"class":"dir"==c["File Type"]?"directory":"file",title:s.options.showTitleAttr?c.Path:null,"data-path":c.Path}).data("itemdata",bb(c));if(f="<td>"+c.Filename+"</td>",f+=c["File Type"]&&""!=c["File Type"]&&"dir"!=c["File Type"]?"<td>"+c["File Type"]+"</td>":"<td></td>",i.Width&&""!=i.Width){var z=i.Width+"x"+i.Height;f+="<td>"+z+"</td>"}else f+="<td></td>";f+=i.Size&&""!=i.Size?"<td>"+V(i.Size)+"</td>":"<td></td>",f+=i["Date Modified"]&&""!=i["Date Modified"]?"<td>"+i["Date Modified"]+"</td>":"<td></td>",w.append(y.append(f))}w.append("</tbody>"),l=w}else l+="<h1>"+t.could_not_retrieve_folder+"</h1>";j.html(l),Xa(),za();var A=n.find("#contents");if("grid"==n.data("view"))A.contextMenu({selector:"li.file, li.directory",build:function(a,b){return{appendTo:".fm-container",items:e(a),callback:function(a,b){var c=b.$trigger.attr("data-path");_a(a,c)}}}}),A.find("li.file, li.directory").draggable({distance:10,cursor:"move",helper:"clone"}),A.find("li.directory-parent, li.directory").droppable({accept:"li.file, li.directory",hoverClass:"drop-hover",drop:function(b,c){var d=c.draggable.attr("data-path"),e=a(b.target).attr("data-path");Ga(d,e)}}),A.find("li").click(function(){var b=a(this).attr("data-path");s.options.quickSelect&&"dir"!=m[b]["File Type"]&&d(m[b],"select")?Ca(m[b]):$a(b)});else{A.contextMenu({selector:"tr.file, tr.directory",build:function(a,b){return{appendTo:".fm-container",items:e(a),callback:function(a,b){var c=b.$trigger.attr("data-path");_a(a,c)}}}}),A.find("tr.file, tr.directory").draggable({distance:10,cursor:"move",helper:"clone"}),A.find("tr.directory-parent, tr.directory").droppable({accept:"tr.file, tr.directory",hoverClass:"drop-hover",drop:function(b,c){var d=c.draggable.attr("data-path"),e=a(b.target).attr("data-path");Ga(d,e)}}),A.find("tbody > tr").click(function(){var b=a(this).attr("data-path");s.options.quickSelect&&"dir"!=m[b]["File Type"]&&d(m[b],"select")?Ca(m[b]):$a(b)}),A.find(".rowHeader > th").click(function(b){var c=a(this),d=c.data("colname"),e=!c.hasClass("sorted-desc"),f=e?"desc":"asc";n.data("list-sort",{column:d,order:f}),Xa()});var B=setInterval(function(){sa(B)},300)}},db=function(b){if(!A[b]||Date.now()-A[b].cached>2e3){var c={mode:"getfolder",path:b,showThumbs:s.options.showThumbs};a.urlParam("type")&&(c.type=a.urlParam("type")),a.ajax({async:!1,url:la(c),dataType:"json",cache:!1,success:function(a){A[b]={cached:Date.now(),data:a}},error:X})}return A[b].data},eb=function(b,c){var d,e=[],f=db(b.dir);if("-1"==f.Code)return void W(f.Error);if(f){for(var g in f){var h=fb(f[g]);if(c&&f[g].Path===c)return h;e.push(h)}var i=a("<ul>",{"class":"jqueryFileTree",style:"display: none;"}).append(e);Wa(i),Aa(i),d=i}else d=a("<h1>").text(t.could_not_retrieve_folder);return d},fb=function(b){var c,d,e=a("<a>",{rel:b.Path,"data-path":b.Path,text:b.Filename}).data("itemdata",bb(b));return"dir"==b["File Type"]?(d=0==b.Protected?"":" directory-locked",c=a("<li>",{"class":"directory collapsed"+d}).append(e)):s.options.listFiles&&(d=0==b.Protected?"":" file-locked",c=a("<li>",{"class":"file ext_"+b["File Type"].toLowerCase()+d}).append(e)),c};D(),a(window).resize(g.setDimensions)}}(jQuery),$.fn.richFm=function(a){return this.each(function(){if(void 0==$(this).data("richFm")){var b=new $.richFmPlugin(this,a);$(this).data("richFm",b)}})},window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),$(window).load(function(){$(".fm-container").richFm()});